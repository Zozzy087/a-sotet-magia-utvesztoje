<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Loki Bás - Isteni Hazugságok</title>
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: "Eczar", serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      color: #d1c3af;
      margin: 0;
      padding: 20px;
      text-align: center;
      background-color: #0c0c0c;
    }
    h1 {
      font-size: 2.6rem;
      margin-bottom: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      text-shadow: 0 0 10px #ff6400;
      letter-spacing: 2px;
    }
    #gameArea {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      margin: 20px 0;
    }
    .player-section {
      background-color: rgba(20, 14, 10, 0.85);
      padding: 20px;
      border-radius: 5px;
      min-width: 260px;
      border: 1px solid #482c17;
      transition: all 0.3s ease;
      position: relative;
    }
    .active-player {
      border: 3px solid #ff6400;
      box-shadow: 0 0 25px rgba(255, 100, 0, 0.7);
      transform: scale(1.05);
      z-index: 2;
    }
    .active-player::before {
      content: "》";
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    .active-player::after {
      content: "《";
      position: absolute;
      right: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    h2 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #d1c3af;
    }
    .lives {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
    }
    .life {
      width: 40px;
      height: 40px;
      background-color: #482c17;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.4);
      transition: all 0.3s;
    }
    .life.lost {
      background-color: #291d14;
      color: #482c17;
      text-shadow: none;
      box-shadow: none;
    }
    .dice-container {
      position: relative;
      margin: 40px 0;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    .dice {
      font-size: 4rem;
      position: relative;
      z-index: 2;
      transition: transform 0.3s ease-out;
    }
    .dice-symbol {
      display: inline-block;
      width: 80px;
      height: 80px;
      line-height: 80px;
      background-color: #291d14;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.3);
      color: #d1c3af;
      font-size: 3rem;
    }
    .dice-roll {
      animation: rollDice 0.8s ease-out;
    }
    @keyframes rollDice {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(720deg) rotateX(360deg); }
      100% { transform: rotateY(1440deg) rotateX(720deg); }
    }
    .dice-hidden {
      background-color: #1a1209;
      color: #1a1209;
    }
    #controls {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .button-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    button {
      font-family: "Eczar", serif;
      font-size: 1.2rem;
      padding: 12px 25px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #482c17;
      color: #d1c3af;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      transition: all 0.3s;
      letter-spacing: 1px;
    }
    button:hover {
      background-color: #5a381f;
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.5);
    }
    button:disabled {
      background-color: #291d14;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      opacity: 0.5;
    }
    .big-button {
      font-size: 1.4rem;
      padding: 15px 30px;
      margin: 20px 10px;
      background-color: #5a381f;
    }
    #declaration, #result {
      font-size: 1.3rem;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      margin-top: 20px;
      max-width: 80%;
      letter-spacing: 1px;
      line-height: 1.4;
    }
    #resetContainer {
      display: none;
      margin-top: 30px;
    }
    .winner {
      color: #ff6400;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 100, 0, 0.7);
    }
    #select-declaration {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .value-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 600px;
      gap: 8px;
      margin: 10px auto;
    }
    .value-button {
      padding: 8px 12px;
      font-size: 1rem;
      background-color: #291d14;
    }
    .value-button:hover {
      background-color: #482c17;
    }
    select {
      font-family: "Eczar", serif;
      background-color: #291d14;
      color: #d1c3af;
      padding: 8px;
      font-size: 1.1rem;
      border: 1px solid #482c17;
      border-radius: 5px;
      outline: none;
      margin: 10px;
    }
    .rules-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: rgba(20, 14, 10, 0.85);
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      z-index: 10;
    }
    .rules-content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 100;
      display: none;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      padding: 20px;
    }
    .rules-box {
      background-color: rgba(20, 14, 10, 0.95);
      padding: 30px;
      border-radius: 10px;
      border: 2px solid #482c17;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    .close-rules {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .rules-box h3 {
      color: #ff6400;
      margin-top: 20px;
    }
    .rules-box ul {
      text-align: left;
      line-height: 1.6;
    }
    .truth-panel {
      display: none;
      background-color: rgba(20, 14, 10, 0.9);
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #ff6400;
      margin: 20px auto;
      max-width: 300px;
    }
    .truth-title {
      color: #ff6400;
      margin-bottom: 10px;
    }
    #history-list {
      list-style: none;
      padding: 0;
      margin: 10px 0;
      max-height: 150px;
      overflow-y: auto;
      background-color: rgba(20, 14, 10, 0.5);
      border-radius: 5px;
      padding: 10px;
    }
    #history-list li {
      padding: 5px;
      border-bottom: 1px solid #482c17;
    }
    #history-list li:last-child {
      border-bottom: none;
    }
    .history-lie {
      color: #ff6400;
    }
    @media (max-width: 600px) {
      .dice-container {
        flex-direction: column;
        align-items: center;
      }
      .button-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

<h1>Loki Bás - Isteni Hazugságok</h1>

<div class="rules-toggle" onclick="toggleRules()">
  <i class="fas fa-book"></i> Szabályok
</div>

<div class="rules-content" id="rulesContent">
  <div class="rules-box">
    <span class="close-rules" onclick="toggleRules()">×</span>
    <h2>A Bás - Isteni Hazugságok Játékszabályai</h2>
    
    <h3>Áttekintés</h3>
    <p>Ez a játék a taktikáról, a hazugságról és az ellenfél kifürkészéséről szól. A legjobb hazudó vagy a legjobb megfigyelő nyeri meg.</p>
    
    <h3>Előkészületek</h3>
    <ul>
      <li>Mindkét játékos 3 "isteni szikrával" (életponttal) kezd.</li>
      <li>Loki (a játékos) kezdi a játékot.</li>
    </ul>
    
    <h3>A Kör Menete</h3>
    <ul>
      <li>Az aktív játékos dob a két kockával úgy, hogy az ellenfél ne lássa az eredményt.</li>
      <li>A dobás értékét bejelenti az ellenfélnek (vagy hazudik).</li>
      <li>Az ellenfél két lehetőség közül választhat: elhiszi vagy kétségbe vonja.</li>
      <li>Ha elhiszi: neki kell dobnia, és olyan értéket kell bejelentenie, ami magasabb az előzőnél. Hazudhat, ha kell.</li>
      <li>Ha nem hiszi el: a dobónak meg kell mutatnia kockáit:</li>
      <ul>
        <li>Ha igazat mondott, az ellenfél veszít egy isteni szikrát</li>
        <li>Ha hazudott, a dobó veszít egy isteni szikrát</li>
      </ul>
      <li>Az új kört mindig a vesztes kezdi, és bármilyen értéket mondhat (nem kell előzőnél nagyobbat).</li>
    </ul>
    
    <h3>Értékek Rangsora (növekvő sorrendben)</h3>
    <ul>
      <li>31, 32, 41, 42, 43, 51, 52, 53, 54, 61, 62, 63, 64, 65</li>
      <li>1-es Fortély (két 1-es), 2-es Fortély (két 2-es), 3-as Fortély (két 3-as), 4-es Fortély (két 4-es), 5-ös Fortély (két 5-ös), 6-os Fortély (két 6-os)</li>
      <li>Csínytevés (21) - a legmagasabb érték</li>
    </ul>
    
    <h3>Dobás Értékelése</h3>
    <ul>
      <li>A számokat mindig úgy olvassuk, hogy a nagyobb szám kerül a tízesek helyére (pl. 4 és 5 dobása = 54)</li>
      <li>Azonos számok dobása "Fortély": pl. két 6-os = 6-os Fortély</li>
      <li>Ha egy 2-est és egy 1-est dobsz, az "Csínytevés" (21), a játék legmagasabb értéke</li>
    </ul>
    
    <h3>A Játék Vége</h3>
    <p>A játék akkor ér véget, amikor az egyik játékos elveszíti az összes isteni szikráját. A győztes az, aki még rendelkezik legalább egy szikrával.</p>
  </div>
</div>

<div id="gameArea">
  <div id="playerSection" class="player-section active-player">
    <h2>Loki (Te)</h2>
    <div class="lives" id="playerLives">
      <div class="life"><i class="fas fa-fire"></i></div>
      <div class="life"><i class="fas fa-fire"></i></div>
      <div class="life"><i class="fas fa-fire"></i></div>
    </div>
  </div>
  
  <div id="diceSection">
    <div class="dice-container">
      <div id="dice1" class="dice">
        <div class="dice-symbol dice-hidden">1</div>
      </div>
      <div id="dice2" class="dice">
        <div class="dice-symbol dice-hidden">1</div>
      </div>
    </div>
    <div class="truth-panel" id="truthPanel">
      <div class="truth-title">A Valóság</div>
      <div id="realValue">--</div>
    </div>
  </div>
  
  <div id="botSection" class="player-section">
    <h2>Thor (Ellenfél)</h2>
    <div class="lives" id="botLives">
      <div class="life"><i class="fas fa-fire"></i></div>
      <div class="life"><i class="fas fa-fire"></i></div>
      <div class="life"><i class="fas fa-fire"></i></div>
    </div>
  </div>
</div>

<div id="declaration">Loki, Te kezdesz! Dobj a kockákkal, és jelents be egy értéket!</div>

<div id="controls">
  <div id="roll-controls">
    <button id="rollBtn" class="big-button" onclick="rollDice()">Dobd a Kockákat!</button>
  </div>
  
  <div id="select-declaration" style="display: none;">
    <div class="value-buttons">
      <!-- Gombokat dinamikusan töltjük be JavaScript-tel -->
    </div>
    <button id="declareBtn" class="big-button" onclick="declareValue()">Érték Bejelentése</button>
  </div>
  
  <div id="response-controls" style="display: none;">
    <div class="button-row">
      <button id="believeBtn" class="big-button" onclick="respondToClaim(true)">Elhiszem</button>
      <button id="doubtBtn" class="big-button" onclick="respondToClaim(false)">Kétségbe Vonom</button>
    </div>
  </div>
</div>

<div id="result"></div>

<div id="gameHistory">
  <h3>Körök Története</h3>
  <ul id="history-list"></ul>
</div>

<div id="resetContainer">
  <button onclick="startGame()">Új Játék</button>
</div>

<script>
// Játék állapota
let playerLives = 3;
let botLives = 3;
let activePlayer = 0; // 0 = játékos, 1 = bot
let gameActive = true;
let lastDeclaredValue = null;
let currentDiceValues = [1, 1];
let selectedDeclaration = null;
let gameRound = 0;
let gameHistory = [];

// Értékek rangsora
const valueRank = {
  '31': 1, '32': 2, '41': 3, '42': 4, '43': 5, 
  '51': 6, '52': 7, '53': 8, '54': 9, 
  '61': 10, '62': 11, '63': 12, '64': 13, '65': 14,
  'fortély1': 15, 'fortély2': 16, 'fortély3': 17, 'fortély4': 18, 'fortély5': 19, 'fortély6': 20,
  'csínytevés': 21
};

// Értékek fordított táblázata
const valueIndex = {};
Object.keys(valueRank).forEach(key => {
  valueIndex[valueRank[key]] = key;
});

// Értékek ember-olvasható formátumban
const readableValues = {
  '31': '31', '32': '32', '41': '41', '42': '42', '43': '43', 
  '51': '51', '52': '52', '53': '53', '54': '54', 
  '61': '61', '62': '62', '63': '63', '64': '64', '65': '65',
  'fortély1': '1-es Fortély', 'fortély2': '2-es Fortély', 'fortély3': '3-as Fortély', 
  'fortély4': '4-es Fortély', 'fortély5': '5-ös Fortély', 'fortély6': '6-os Fortély',
  'csínytevés': 'Csínytevés'
};

// DOM elemek
const diceEl1 = document.getElementById('dice1');
const diceEl2 = document.getElementById('dice2');
const playerSection = document.getElementById('playerSection');
const botSection = document.getElementById('botSection');
const declarationEl = document.getElementById('declaration');
const resultEl = document.getElementById('result');
const historyListEl = document.getElementById('history-list');

// Értékválasztó gombok inicializálása
initValueButtons();

// Játék indítása
function startGame() {
  playerLives = 3;
  botLives = 3;
  activePlayer = 0; // Játékos kezd
  gameActive = true;
  lastDeclaredValue = null;
  selectedDeclaration = null;
  gameRound = 0;
  gameHistory = [];
  
  // UI visszaállítása
  updateLives();
  resetDice();
  document.getElementById('truthPanel').style.display = 'none';
  document.getElementById('rollBtn').style.display = 'block';
  document.getElementById('select-declaration').style.display = 'none';
  document.getElementById('response-controls').style.display = 'none';
  document.getElementById('resetContainer').style.display = 'none';
  declarationEl.textContent = 'Loki, Te kezdesz! Dobj a kockákkal, és jelents be egy értéket!';
  resultEl.textContent = '';
  historyListEl.innerHTML = '';
  
  // Aktív játékos kijelölése
  updateActivePlayer();
}

// Kockák visszaállítása
function resetDice() {
  diceEl1.querySelector('.dice-symbol').innerHTML = '1';
  diceEl2.querySelector('.dice-symbol').innerHTML = '1';
  diceEl1.querySelector('.dice-symbol').classList.add('dice-hidden');
  diceEl2.querySelector('.dice-symbol').classList.add('dice-hidden');
  diceEl1.classList.remove('dice-roll');
  diceEl2.classList.remove('dice-roll');
  document.getElementById('realValue').textContent = '--';
}

// Kockadobás animáció és eredmény
function rollDice() {
  if (!gameActive || activePlayer !== 0) return;
  
  // Véletlen értékek generálása
  const value1 = Math.floor(Math.random() * 6) + 1;
  const value2 = Math.floor(Math.random() * 6) + 1;
  currentDiceValues = [value1, value2];
  
  // Animáció és megjelenítés
  animateDiceRoll(value1, value2);
  
  // Aktiváljuk az értékválasztó panelt
  setTimeout(() => {
    document.getElementById('rollBtn').style.display = 'none';
    document.getElementById('select-declaration').style.display = 'block';
    populateAvailableValues();
    
    if (lastDeclaredValue === null) {
      declarationEl.textContent = 'Válassz egy értéket, amit bejelentesz Thornak!';
    } else {
      declarationEl.textContent = `Thor legutóbb ${getReadableValue(lastDeclaredValue)}-t jelentett be. Jelentsd be a te értékedet (nagyobbnak kell lennie)!`;
    }
  }, 1000);
}

// Kockadobás animáció
function animateDiceRoll(value1, value2) {
  diceEl1.classList.remove('dice-roll');
  diceEl2.classList.remove('dice-roll');
  
  setTimeout(() => {
    diceEl1.querySelector('.dice-symbol').innerHTML = value1;
    diceEl2.querySelector('.dice-symbol').innerHTML = value2;
    diceEl1.querySelector('.dice-symbol').classList.remove('dice-hidden');
    diceEl2.querySelector('.dice-symbol').classList.remove('dice-hidden');
    diceEl1.classList.add('dice-roll');
    diceEl2.classList.add('dice-roll');
  }, 10);
}

// Értékválasztó gombok inicializálása
function initValueButtons() {
  const container = document.querySelector('.value-buttons');
  container.innerHTML = '';
  
  Object.keys(readableValues).forEach(value => {
    const button = document.createElement('button');
    button.className = 'value-button';
    button.textContent = readableValues[value];
    button.dataset.value = value;
    button.onclick = () => selectValue(value);
    container.appendChild(button);
  });
}

// Elérhető értékek szűrése (ha szükséges)
function populateAvailableValues() {
  const buttons = document.querySelectorAll('.value-button');
  
  buttons.forEach(button => {
    if (lastDeclaredValue === null) {
      button.disabled = false;
    } else {
      const value = button.dataset.value;
      button.disabled = valueRank[value] <= valueRank[lastDeclaredValue];
    }
  });
}

// Érték kiválasztása
function selectValue(value) {
  selectedDeclaration = value;
  const buttons = document.querySelectorAll('.value-button');
  buttons.forEach(button => {
    if (button.dataset.value === value) {
      button.style.backgroundColor = '#5a381f';
    } else {
      button.style.backgroundColor = '#291d14';
    }
  });
}

// Érték bejelentése
function declareValue() {
  if (selectedDeclaration === null) {
    declarationEl.textContent = 'Előbb válassz egy értéket!';
    return;
  }
  
  // Valós dobás értékének kiszámítása
  const realValue = calculateDiceValue(currentDiceValues[0], currentDiceValues[1]);
  document.getElementById('realValue').textContent = getReadableValue(realValue);
  
  // Bejelentés hozzáadása a játéktörténethez
  addToHistory({
    round: gameRound,
    player: 'Loki',
    declared: selectedDeclaration,
    actual: realValue,
    isLie: selectedDeclaration !== realValue
  });
  
  // Elrejtem a játékostól a kockákat és az értékválasztót
  diceEl1.querySelector('.dice-symbol').classList.add('dice-hidden');
  diceEl2.querySelector('.dice-symbol').classList.add('dice-hidden');
  document.getElementById('select-declaration').style.display = 'none';
  
  // Bot válaszol
  declarationEl.textContent = `${getReadableValue(selectedDeclaration)}-t jelentettél be. Thor gondolkodik...`;
  
  setTimeout(() => {
    botRespond();
  }, 2000);
}

// Bot válasza a bejelentésre
function botRespond() {
  const realValue = calculateDiceValue(currentDiceValues[0], currentDiceValues[1]);
  const declaredRank = valueRank[selectedDeclaration];
  const realRank = valueRank[realValue];
  
  // A bot stratégiája
  let believeProbability = 0.6; // Alap esély
  
  // Ha túl magas értéket jelentett be a játékos
  if (declaredRank > realRank + 4) {
    believeProbability -= 0.3;
  }
  
  // Ha a bejelentett érték nagyon magas
  if (declaredRank >= 19) {
    believeProbability -= 0.2;
  }
  
  // Ha a bot már korábban vesztett életet, óvatosabb
  if (botLives < 3) {
    believeProbability += 0.1;
  }
  
  // A játékos korábbi viselkedésének elemzése
  const playerLiePattern = analyzePlayerLies();
  believeProbability -= playerLiePattern * 0.2;
  
  // A bot döntése
  const botBelieves = Math.random() < believeProbability;
  
  if (botBelieves) {
    // Bot elhiszi
    declarationEl.textContent = `Thor elhiszi a bejelentésedet (${getReadableValue(selectedDeclaration)})!`;
    lastDeclaredValue = selectedDeclaration;
    setTimeout(() => botTurn(), 2000);
  } else {
    // Bot kétségbe vonja
    declarationEl.textContent = `Thor kétségbe vonja a bejelentésedet! Lássuk az igazságot...`;
    document.getElementById('truthPanel').style.display = 'block';
    diceEl1.querySelector('.dice-symbol').classList.remove('dice-hidden');
    diceEl2.querySelector('.dice-symbol').classList.remove('dice-hidden');
    
    setTimeout(() => {
      if (selectedDeclaration === realValue) {
        // Igazat mondott a játékos
        botLives--;
        resultEl.textContent = `Igazat mondtál! Thor veszít egy isteni szikrát!`;
        updateLives();
        checkGameEnd();
      } else {
        // Hazudott a játékos
        playerLives--;
        resultEl.textContent = `Hazudtál! Te veszítesz egy isteni szikrát!`;
        updateLives();
        checkGameEnd();
      }
      
      // Ha még tart a játék, új kör kezdése
      if (gameActive) {
        gameRound++;
        lastDeclaredValue = null; // Új kör, bármilyen értéket mondhat
        setTimeout(() => {
          resetDice();
          document.getElementById('truthPanel').style.display = 'none';
          activePlayer = 1; // Bot kezd
          updateActivePlayer();
          botTurn();
        }, 2000);
      }
    }, 2000);
  }
}

// Bot köre
function botTurn() {
  if (!gameActive) return;
  
  declarationEl.textContent = `Thor dob a kockákkal...`;
  
  // Bot dob
  const value1 = Math.floor(Math.random() * 6) + 1;
  const value2 = Math.floor(Math.random() * 6) + 1;
  const realValue = calculateDiceValue(value1, value2);
  
  // Bot stratégiája a bejelentéshez
  let declaredValue;
  
  if (lastDeclaredValue === null) {
    // Új kör, bármilyen értéket mondhat
    if (realValue === 'csínytevés' || Math.random() < 0.8) {
      // Valós értéket mond
      declaredValue = realValue;
    } else {
      // Kicsit hazudik, de nem túl merészen
      const availableValues = Object.keys(valueRank).filter(v => 
        valueRank[v] > valueRank[realValue] && valueRank[v] <= valueRank[realValue] + 3
      );
      if (availableValues.length > 0) {
        declaredValue = availableValues[Math.floor(Math.random() * availableValues.length)];
      } else {
        declaredValue = realValue;
      }
    }
  } else {
    const minRank = valueRank[lastDeclaredValue] + 1;
    
    if (valueRank[realValue] >= minRank) {
      // A valós dobás elég magas, használhatja
      declaredValue = realValue;
    } else {
      // Hazudnia kell
      // Mennyire merjen hazudni?
      const riskFactor = Math.min(1, 0.3 + (botLives / 3) * 0.4); // Több élet = nagyobb kockázat
      const maxExtraRank = Math.floor(7 * riskFactor);
      
      // Lehetséges értékek a minRank és minRank+maxExtraRank között
      const targetRank = minRank + Math.floor(Math.random() * maxExtraRank);
      declaredValue = valueIndex[Math.min(targetRank, 21)]; // Max 21 (Csínytevés)
    }
  }
  
  // Bot bejelenti az értékét
  addToHistory({
    round: gameRound,
    player: 'Thor',
    declared: declaredValue,
    actual: realValue,
    isLie: declaredValue !== realValue
  });
  
  setTimeout(() => {
    declarationEl.textContent = `Thor ${getReadableValue(declaredValue)}-t jelent be. Mit teszel?`;
    
    // A játékos válaszol
    document.getElementById('response-controls').style.display = 'block';
    lastDeclaredValue = declaredValue;
    currentDiceValues = [value1, value2]; // Elmentjük a bot dobását
  }, 2000);
}

// Játékos válasza a bot állítására
function respondToClaim(believes) {
  document.getElementById('response-controls').style.display = 'none';
  
  // A valós dobás értéke
  const realValue = calculateDiceValue(currentDiceValues[0], currentDiceValues[1]);
  
  if (believes) {
    // Játékos elhiszi
    declarationEl.textContent = `Elhiszed Thor állítását. Most te dobsz!`;
    
    setTimeout(() => {
      resetDice();
      activePlayer = 0; // Játékos következik
      updateActivePlayer();
      document.getElementById('rollBtn').style.display = 'block';
      declarationEl.textContent = `Dobj a kockákkal, és jelents be egy ${getReadableValue(lastDeclaredValue)}-nél nagyobb értéket!`;
    }, 2000);
  } else {
    // Játékos kétségbe vonja
    declarationEl.textContent = `Kétségbe vonod Thor állítását! Lássuk az igazságot...`;
    document.getElementById('truthPanel').style.display = 'block';
    
    // A kockák láthatóvá tétele
    diceEl1.querySelector('.dice-symbol').classList.remove('dice-hidden');
    diceEl1.querySelector('.dice-symbol').innerHTML = currentDiceValues[0];
    diceEl2.querySelector('.dice-symbol').classList.remove('dice-hidden');
    diceEl2.querySelector('.dice-symbol').innerHTML = currentDiceValues[1];
    document.getElementById('realValue').textContent = getReadableValue(realValue);
    
    setTimeout(() => {
      if (lastDeclaredValue === realValue) {
        // Bot igazat mondott
        playerLives--;
        resultEl.textContent = `Thor igazat mondott! Te veszítesz egy isteni szikrát!`;
        updateLives();
        checkGameEnd();
      } else {
        // Bot hazudott
        botLives--;
        resultEl.textContent = `Thor hazudott! Ő veszít egy isteni szikrát!`;
        updateLives();
        checkGameEnd();
      }
      
      // Ha még tart a játék, új kör kezdése
      if (gameActive) {
        gameRound++;
        lastDeclaredValue = null; // Új kör, bármilyen értéket mondhat
        setTimeout(() => {
          resetDice();
          document.getElementById('truthPanel').style.display = 'none';
          activePlayer = 0; // Játékos kezd
          updateActivePlayer();
          document.getElementById('rollBtn').style.display = 'block';
          declarationEl.textContent = 'Új kör! Dobj a kockákkal, és jelents be egy értéket!';
        }, 2000);
      }
    }, 2000);
  }
}

// Életpontok frissítése
function updateLives() {
  const playerLivesEl = document.getElementById('playerLives');
  const botLivesEl = document.getElementById('botLives');
  
  playerLivesEl.innerHTML = '';
  botLivesEl.innerHTML = '';
  
  for (let i = 0; i < 3; i++) {
    const playerLifeEl = document.createElement('div');
    playerLifeEl.className = i < playerLives ? 'life' : 'life lost';
    playerLifeEl.innerHTML = i < playerLives ? '<i class="fas fa-fire"></i>' : '<i class="fas fa-fire"></i>';
    playerLivesEl.appendChild(playerLifeEl);
    
    const botLifeEl = document.createElement('div');
    botLifeEl.className = i < botLives ? 'life' : 'life lost';
    botLifeEl.innerHTML = i < botLives ? '<i class="fas fa-fire"></i>' : '<i class="fas fa-fire"></i>';
    botLivesEl.appendChild(botLifeEl);
  }
}

// Aktív játékos frissítése
function updateActivePlayer() {
  if (activePlayer === 0) {
    playerSection.classList.add('active-player');
    botSection.classList.remove('active-player');
  } else {
    playerSection.classList.remove('active-player');
    botSection.classList.add('active-player');
  }
}

// Dobás értékének kiszámítása
function calculateDiceValue(value1, value2) {
  // Csínytevés (21) ellenőrzése
  if ((value1 === 2 && value2 === 1) || (value1 === 1 && value2 === 2)) {
    return 'csínytevés';
  }
  
  // Fortély (dupla) ellenőrzése
  if (value1 === value2) {
    return `fortély${value1}`;
  }
  
  // Normál értékek - nagyobb szám a tízesek helyére
  const higher = Math.max(value1, value2);
  const lower = Math.min(value1, value2);
  return `${higher}${lower}`;
}

// Olvasható érték formátuma
function getReadableValue(value) {
  return readableValues[value] || value;
}

// Játékos hazudási mintájának elemzése
function analyzePlayerLies() {
  if (gameHistory.length < 3) return 0.5; // Alapértelmezett, ha nincs elég adat
  
  const playerHistory = gameHistory.filter(entry => entry.player === 'Loki');
  const lies = playerHistory.filter(entry => entry.isLie).length;
  
  return lies / playerHistory.length; // 0-1 közötti érték, magasabb = gyakrabban hazudik
}

// Játéktörténet hozzáadása
function addToHistory(entry) {
  gameHistory.push(entry);
  
  const li = document.createElement('li');
  const playerText = entry.player === 'Loki' ? 'Te' : 'Thor';
  const lieClass = entry.isLie ? 'history-lie' : '';
  
  li.innerHTML = `Kör ${entry.round + 1}: ${playerText} ${getReadableValue(entry.declared)}-t jelentettél be ` +
                 `(Valós: ${getReadableValue(entry.actual)})` +
                 `${entry.isLie ? ' <span class="history-lie">- HAZUGSÁG!</span>' : ''}`;
  
  historyListEl.prepend(li);
}

// Játék vége ellenőrzése
function checkGameEnd() {
  if (playerLives <= 0) {
    gameActive = false;
    resultEl.innerHTML = '<span class="winner">Thor győzött! Elvesztetted az összes isteni szikrádat.</span>';
    document.getElementById('resetContainer').style.display = 'block';
  } else if (botLives <= 0) {
    gameActive = false;
    resultEl.innerHTML = '<span class="winner">Loki győzött! Thor elvesztette az összes isteni szikráját!</span>';
    document.getElementById('resetContainer').style.display = 'block';
  }
}

// Szabályok megjelenítése/elrejtése
function toggleRules() {
  const rulesContent = document.getElementById('rulesContent');
  if (rulesContent.style.display === 'flex') {
    rulesContent.style.display = 'none';
  } else {
    rulesContent.style.display = 'flex';
  }
}

// Játék indítása
startGame();
</script>

</body>
</html>
