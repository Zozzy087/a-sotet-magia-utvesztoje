<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Fantasy Bash</title>
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: "Eczar", serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      color: #d1c3af;
      margin: 0;
      padding: 20px;
      text-align: center;
      background-color: #0c0c0c;
    }
    h1 {
      font-size: 2.6rem;
      margin-bottom: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      text-shadow: 0 0 10px #ff6400;
      letter-spacing: 2px;
    }
    #gameArea {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      margin: 20px 0;
    }
    .player-section {
      background-color: rgba(20, 14, 10, 0.85);
      padding: 20px;
      border-radius: 5px;
      min-width: 300px;
      border: 1px solid #482c17;
      transition: all 0.3s ease;
      position: relative;
    }
    .active-player {
      border: 3px solid #ff6400;
      box-shadow: 0 0 25px rgba(255, 100, 0, 0.7);
      transform: scale(1.05);
      z-index: 2;
    }
    .active-player::before {
      content: "》";
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    .active-player::after {
      content: "《";
      position: absolute;
      right: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    h2 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #d1c3af;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      margin: 15px 0;
      gap: 10px;
    }
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }
    .stat-label {
      font-size: 1rem;
      margin-bottom: 5px;
    }
    .stat-value {
      font-size: 1.8rem;
      text-shadow: 0 0 10px rgba(255, 100, 0, 0.5);
    }
    .health-bar, .mana-bar {
      width: 100%;
      height: 20px;
      background-color: #291d14;
      border-radius: 10px;
      overflow: hidden;
      margin: 5px 0;
      position: relative;
    }
    .health-fill {
      height: 100%;
      background-color: #a12312;
      width: 100%;
      transition: width 0.5s ease;
    }
    .mana-fill {
      height: 100%;
      background-color: #1f5a9e;
      width: 100%;
      transition: width 0.5s ease;
    }
    .status-effects {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    .effect {
      background-color: rgba(72, 44, 23, 0.6);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .effect i {
      color: #ff6400;
    }
    .battle-log {
      background-color: rgba(20, 14, 10, 0.7);
      padding: 15px;
      border-radius: 5px;
      max-height: 200px;
      overflow-y: auto;
      margin: 20px auto;
      max-width: 80%;
      text-align: left;
      font-size: 1.1rem;
    }
    .battle-log p {
      margin: 5px 0;
      border-bottom: 1px solid rgba(209, 195, 175, 0.2);
      padding-bottom: 5px;
    }
    .battle-log .player-action {
      color: #d1c3af;
    }
    .battle-log .enemy-action {
      color: #ff6400;
    }
    .battle-log .critical {
      color: #ff0000;
      font-weight: bold;
    }
    .battle-log .heal {
      color: #00ff00;
    }
    .combat-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
      min-width: 400px;
    }
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    button {
      font-family: "Eczar", serif;
      font-size: 1.2rem;
      padding: 12px 25px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #482c17;
      color: #d1c3af;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 120px;
    }
    button:hover {
      background-color: #5a381f;
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.5);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    button i {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    .button-tooltip {
      font-size: 0.8rem;
      color: #a7a7a7;
    }
    .cooldown {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background-color: rgba(0, 0, 0, 0.7);
      color: #ff6400;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }
    .ability-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .ability-button {
      position: relative;
    }
    #message {
      font-size: 1.3rem;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      margin-top: 20px;
      max-width: 80%;
      letter-spacing: 1px;
      line-height: 1.4;
    }
    .winner {
      color: #ff6400;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 100, 0, 0.7);
    }
    #resetContainer {
      display: none;
      margin-top: 30px;
    }
    .combat-icon {
      font-size: 2.5rem;
      margin: 15px 0;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    .damage {
      position: absolute;
      color: #ff0000;
      font-size: 1.5rem;
      font-weight: bold;
      animation: damageAnim 1s forwards;
      text-shadow: 0 0 10px #000;
    }
    @keyframes damageAnim {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-40px); opacity: 0; }
    }
    .heal-anim {
      position: absolute;
      color: #00ff00;
      font-size: 1.5rem;
      font-weight: bold;
      animation: healAnim 1s forwards;
      text-shadow: 0 0 10px #000;
    }
    @keyframes healAnim {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-40px); opacity: 0; }
    }
    .character-portrait {
      width: 100px;
      height: 100px;
      border-radius: 10px;
      background-color: #291d14;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      overflow: hidden;
    }
    .character-icon {
      font-size: 4rem;
      color: #d1c3af;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #000;
      color: #d1c3af;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.9rem;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>

<h1>Fantasy Bash</h1>

<div id="gameArea">
  <div id="playerSection" class="player-section active-player">
    <div class="character-portrait">
      <i class="fas fa-user-shield character-icon"></i>
    </div>
    <h2>Kalandor</h2>
    <div class="stats">
      <div class="stat-item">
        <div class="stat-label">Életerő</div>
        <div class="health-bar">
          <div id="playerHealthFill" class="health-fill"></div>
        </div>
        <div class="stat-value"><span id="playerHealth">100</span>/<span id="playerMaxHealth">100</span></div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Mana</div>
        <div class="mana-bar">
          <div id="playerManaFill" class="mana-fill"></div>
        </div>
        <div class="stat-value"><span id="playerMana">50</span>/<span id="playerMaxMana">50</span></div>
      </div>
    </div>
    <div id="playerStatusEffects" class="status-effects"></div>
  </div>
  
  <div class="combat-area">
    <div id="combatIcon" class="combat-icon">
      <i class="fas fa-swords"></i>
    </div>
    
    <div class="action-buttons">
      <button id="attackBtn" class="tooltip" onclick="useAction('attack')">
        <i class="fas fa-sword"></i>
        Támadás
        <span class="tooltiptext">Alap támadás (8-12 sebzés)</span>
      </button>
      <button id="defendBtn" class="tooltip" onclick="useAction('defend')">
        <i class="fas fa-shield"></i>
        Védekezés
        <span class="tooltiptext">50% sebzéscsökkentés a következő körben</span>
      </button>
      <button id="focusBtn" class="tooltip" onclick="useAction('focus')">
        <i class="fas fa-atom"></i>
        Koncentráció
        <span class="tooltiptext">+15 mana és +25% kritikus esély a következő körben</span>
      </button>
    </div>
    
    <div class="ability-buttons">
      <div class="ability-button tooltip">
        <button id="slashBtn" onclick="useAbility('slash')">
          <i class="fas fa-wind"></i>
          Pusztító Vágás
          <div class="button-tooltip">15 mana | 15-20 sebzés</div>
        </button>
        <span class="tooltiptext">Erős támadás, 15-20 sebzést okoz, de 15 manába kerül</span>
      </div>
      
      <div class="ability-button tooltip">
        <button id="healBtn" onclick="useAbility('heal')">
          <i class="fas fa-heart"></i>
          Gyógyítás
          <div class="button-tooltip">20 mana | +20-25 HP</div>
        </button>
        <span class="tooltiptext">Gyógyít 20-25 életerőt, 20 manába kerül</span>
      </div>
      
      <div class="ability-button tooltip">
        <button id="fireballBtn" onclick="useAbility('fireball')">
          <i class="fas fa-fire-alt"></i>
          Tűzgolyó
          <div class="button-tooltip">25 mana | 20-30 sebzés</div>
        </button>
        <span class="tooltiptext">Tűzgolyót idéz, 20-30 sebzést okoz és 25% eséllyel égést okoz, 25 manába kerül</span>
      </div>
      
      <div class="ability-button tooltip">
        <button id="stunBtn" onclick="useAbility('stun')">
          <i class="fas fa-bolt"></i>
          Kábítás
          <div class="button-tooltip">30 mana | Ellenség kihagy 1 kört</div>
          <div id="stunCooldown" class="cooldown" style="display: none;">3</div>
        </button>
        <span class="tooltiptext">Kábítás az ellenségre, aki kihagy egy kört. 30 manába kerül és 3 kör újratöltési ideje van</span>
      </div>
    </div>
    
    <div id="message">A csata kezdetét vette! Válassz egy akciót!</div>
    
    <div class="battle-log" id="battleLog">
      <p>A csata kezdetét vette. Válassz egy támadási módot!</p>
    </div>
  </div>
  
  <div id="enemySection" class="player-section">
    <div class="character-portrait">
      <i class="fas fa-dragon character-icon"></i>
    </div>
    <h2>Sötét Nagyúr</h2>
    <div class="stats">
      <div class="stat-item">
        <div class="stat-label">Életerő</div>
        <div class="health-bar">
          <div id="enemyHealthFill" class="health-fill"></div>
        </div>
        <div class="stat-value"><span id="enemyHealth">120</span>/<span id="enemyMaxHealth">120</span></div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Mana</div>
        <div class="mana-bar">
          <div id="enemyManaFill" class="mana-fill"></div>
        </div>
        <div class="stat-value"><span id="enemyMana">60</span>/<span id="enemyMaxMana">60</span></div>
      </div>
    </div>
    <div id="enemyStatusEffects" class="status-effects"></div>
  </div>
</div>

<div id="resetContainer">
  <button onclick="startGame()">Új Kihívás</button>
</div>

<script>
// Játék változók és állapot
let gameActive = true;
let roundCounter = 0;
let playerTurn = true;

// Játékos és ellenség statisztikák
const player = {
  health: 100,
  maxHealth: 100,
  mana: 50,
  maxMana: 50,
  baseDamage: [8, 12],
  statusEffects: [],
  actionHistory: [],
  critChance: 0.15,
  critMultiplier: 1.5,
  defense: 0,
  abilities: {
    stun: { cooldown: 0, maxCooldown: 3 }
  }
};

const enemy = {
  health: 120,
  maxHealth: 120,
  mana: 60,
  maxMana: 60,
  baseDamage: [10, 14],
  statusEffects: [],
  actionHistory: [],
  critChance: 0.1,
  critMultiplier: 1.5,
  defense: 0,
  abilities: {
    // Ellenség képességei és az újratöltési idők
    darkBolt: { cooldown: 0, maxCooldown: 2 },
    shadowHeal: { cooldown: 0, maxCooldown: 4 },
    demonForm: { cooldown: 0, maxCooldown: 5 }
  },
  // AI taktikai beállítások
  tacticalThresholds: {
    lowHealth: 0.3,    // Ha 30% alatt van az életerő
    mediumHealth: 0.6, // Ha 60% alatt van az életerő
    lowMana: 0.2,      // Ha 20% alatt van a mana
    defensiveThreshold: 0.4 // Ha a játékos utolsó támadása az életerő 40%-át okozta
  }
};

// DOM elemek
const battleLogElement = document.getElementById('battleLog');
const messageElement = document.getElementById('message');
const playerHealthElement = document.getElementById('playerHealth');
const playerMaxHealthElement = document.getElementById('playerMaxHealth');
const playerManaElement = document.getElementById('playerMana');
const playerMaxManaElement = document.getElementById('playerMaxMana');
const playerHealthFillElement = document.getElementById('playerHealthFill');
const playerManaFillElement = document.getElementById('playerManaFill');
const playerStatusEffectsElement = document.getElementById('playerStatusEffects');
const enemyHealthElement = document.getElementById('enemyHealth');
const enemyMaxHealthElement = document.getElementById('enemyMaxHealth');
const enemyManaElement = document.getElementById('enemyMana');
const enemyMaxManaElement = document.getElementById('enemyMaxMana');
const enemyHealthFillElement = document.getElementById('enemyHealthFill');
const enemyManaFillElement = document.getElementById('enemyManaFill');
const enemyStatusEffectsElement = document.getElementById('enemyStatusEffects');
const combatIconElement = document.getElementById('combatIcon');
const playerSectionElement = document.getElementById('playerSection');
const enemySectionElement = document.getElementById('enemySection');
const resetContainerElement = document.getElementById('resetContainer');

// Játék indítása
function startGame() {
  gameActive = true;
  roundCounter = 0;
  playerTurn = true;
  
  // Játékos alaphelyzetbe állítása
  player.health = player.maxHealth;
  player.mana = player.maxMana;
  player.statusEffects = [];
  player.actionHistory = [];
  player.defense = 0;
  player.abilities.stun.cooldown = 0;
  
  // Ellenség alaphelyzetbe állítása
  enemy.health = enemy.maxHealth;
  enemy.mana = enemy.maxMana;
  enemy.statusEffects = [];
  enemy.actionHistory = [];
  enemy.defense = 0;
  enemy.abilities.darkBolt.cooldown = 0;
  enemy.abilities.shadowHeal.cooldown = 0;
  enemy.abilities.demonForm.cooldown = 0;
  
  // UI alaphelyzetbe állítása
  updateUI();
  
  // Gombok engedélyezése
  enableAllButtons();
  
  // Aktív játékos kijelölése
  playerSectionElement.classList.add('active-player');
  enemySectionElement.classList.remove('active-player');
  
  // Reset gomb elrejtése
  resetContainerElement.style.display = 'none';
  
  // Harci napló tisztítása
  battleLogElement.innerHTML = '<p>A csata kezdetét vette. Válassz egy támadási módot!</p>';
  messageElement.textContent = 'A csata kezdetét vette! Válassz egy akciót!';
}

// UI frissítése
function updateUI() {
  // Játékos statisztikák frissítése
  playerHealthElement.textContent = Math.max(0, Math.floor(player.health));
  playerMaxHealthElement.textContent = player.maxHealth;
  playerManaElement.textContent = Math.max(0, Math.floor(player.mana));
  playerMaxManaElement.textContent = player.maxMana;
  playerHealthFillElement.style.width = `${(player.health / player.maxHealth) * 100}%`;
  playerManaFillElement.style.width = `${(player.mana / player.maxMana) * 100}%`;
  
  // Ellenség statisztikák frissítése
  enemyHealthElement.textContent = Math.max(0, Math.floor(enemy.health));
  enemyMaxHealthElement.textContent = enemy.maxHealth;
  enemyManaElement.textContent = Math.max(0, Math.floor(enemy.mana));
  enemyMaxManaElement.textContent = enemy.maxMana;
  enemyHealthFillElement.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
  enemyManaFillElement.style.width = `${(enemy.mana / enemy.maxMana) * 100}%`;
  
  // Játékos állapothatások frissítése
  updateStatusEffects(player, playerStatusEffectsElement);
  
  // Ellenség állapothatások frissítése
  updateStatusEffects(enemy, enemyStatusEffectsElement);
  
  // Képességgombok állapotának frissítése
  updateAbilityButtons();
  
  // Képességek újratöltési idejének frissítése
  updateCooldowns();
}

// Állapothatások frissítése
function updateStatusEffects(character, element) {
  element.innerHTML = '';
  
  character.statusEffects.forEach(effect => {
    if (effect.duration > 0) {
      const effectElement = document.createElement('div');
      effectElement.className = 'effect';
      effectElement.innerHTML = `<i class="${effect.icon}"></i> ${effect.name} (${effect.duration})`;
      element.appendChild(effectElement);
    }
  });
}

// Képesség gombok frissítése
function updateAbilityButtons() {
  // Slash képesség
  document.getElementById('slashBtn').disabled = player.mana < 15 || !gameActive || !playerTurn;
  
  // Heal képesség
  document.getElementById('healBtn').disabled = player.mana < 20 || !gameActive || !playerTurn;
  
  // Fireball képesség
  document.getElementById('fireballBtn').disabled = player.mana < 25 || !gameActive || !playerTurn;
  
  // Stun képesség
  const stunButton = document.getElementById('stunBtn');
  const stunCooldown = document.getElementById('stunCooldown');
  
  stunButton.disabled = player.mana < 30 || player.abilities.stun.cooldown > 0 || !gameActive || !playerTurn;
  
  if (player.abilities.stun.cooldown > 0) {
    stunCooldown.textContent = player.abilities.stun.cooldown;
    stunCooldown.style.display = 'flex';
  } else {
    stunCooldown.style.display = 'none';
  }
  
  // Alap akció gombok
  document.getElementById('attackBtn').disabled = !gameActive || !playerTurn;
  document.getElementById('defendBtn').disabled = !gameActive || !playerTurn;
  document.getElementById('focusBtn').disabled = !gameActive || !playerTurn;
}

// Újratöltési idők frissítése
function updateCooldowns() {
  // Játékos képességek újratöltési idejének csökkentése
  for (const ability in player.abilities) {
    if (player.abilities[ability].cooldown > 0) {
      player.abilities[ability].cooldown--;
    }
  }
  
  // Ellenség képességek újratöltési idejének csökkentése
  for (const ability in enemy.abilities) {
    if (enemy.abilities[ability].cooldown > 0) {
      enemy.abilities[ability].cooldown--;
    }
  }
}

// Alap akció végrehajtása
function useAction(actionType) {
  if (!gameActive || !playerTurn) return;
  
  player.actionHistory.push({
    round: roundCounter,
    action: actionType
  });
  
  switch (actionType) {
    case 'attack':
      performAttack(player, enemy);
      break;
    case 'defend':
      performDefend(player);
      break;
    case 'focus':
      performFocus(player);
      break;
  }
  
  endPlayerTurn();
}

// Képesség használata
function useAbility(abilityType) {
  if (!gameActive || !playerTurn) return;
  
  player.actionHistory.push({
    round: roundCounter,
    action: `ability_${abilityType}`
  });
  
  switch (abilityType) {
    case 'slash':
      if (player.mana >= 15) {
        player.mana -= 15;
        performSlash(player, enemy);
      } else {
        logMessage("Nincs elég mana a Pusztító Vágáshoz!");
        return;
      }
      break;
    case 'heal':
      if (player.mana >= 20) {
        player.mana -= 20;
        performHeal(player);
      } else {
        logMessage("Nincs elég mana a Gyógyításhoz!");
        return;
      }
      break;
    case 'fireball':
      if (player.mana >= 25) {
        player.mana -= 25;
        performFireball(player, enemy);
      } else {
        logMessage("Nincs elég mana a Tűzgolyóhoz!");
        return;
      }
      break;
    case 'stun':
      if (player.mana >= 30 && player.abilities.stun.cooldown === 0) {
        player.mana -= 30;
        player.abilities.stun.cooldown = player.abilities.stun.maxCooldown;
        performStun(player, enemy);
      } else if (player.abilities.stun.cooldown > 0) {
        logMessage(`A Kábítás még ${player.abilities.stun.cooldown} kör múlva lesz újra használható!`);
        return;
      } else {
        logMessage("Nincs elég mana a Kábításhoz!");
        return;
      }
      break;
  }
  
  endPlayerTurn();
}

// Játékos körének vége
function endPlayerTurn() {
  playerTurn = false;
  updateUI();
  
  // Aktív játékos jelzése
  playerSectionElement.classList.remove('active-player');
  enemySectionElement.classList.add('active-player');
  
  // Ellenség akciója kis késleltetéssel
  setTimeout(() => {
    // Ellenőrzés, hogy a játék még aktív-e
    if (!gameActive) return;
    
    // Körök frissítése és státuszhatások feldolgozása
    processStatusEffects(enemy);
    
    // Ha az ellenség kábult, kihagyja a körét
    if (hasStatusEffect(enemy, 'stunned')) {
      logMessage("A Sötét Nagyúr kábult, kihagyja a körét!", 'enemy-action');
    } else {
      executeEnemyTurn();
    }
    
    // Ellenőrzés, hogy a játék még mindig aktív-e
    if (!gameActive) return;
    
    // Újra a játékos köre
    setTimeout(() => {
      roundCounter++;
      playerTurn = true;
      
      // Státuszhatások feldolgozása a játékosnál a köre elején
      processStatusEffects(player);
      
      // UI frissítése
      updateUI();
      
      // Aktív játékos jelzése
      playerSectionElement.classList.add('active-player');
      enemySectionElement.classList.remove('active-player');
      
      // Üzenet kijelzése
      messageElement.textContent = 'A te köröd! Válassz egy akciót!';
    }, 1000);
  }, 1500);
}

// Ellenség körének végrehajtása
function executeEnemyTurn() {
  // Az AI döntést hoz a következő lépésről
  const enemyAction = determineEnemyAction();
  
  // Az ellenfél döntéseinek nyilvántartása
  enemy.actionHistory.push({
    round: roundCounter,
    action: enemyAction.type
  });
  
  // A kiválasztott akció végrehajtása
  executeEnemyAction(enemyAction);
}

// A játékos támadásának végrehajtása
function performAttack(attacker, target) {
  const damageRange = attacker.baseDamage;
  const baseDamage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];
  
  // Kritikus találat esélye
  const isCritical = Math.random() < attacker.critChance;
  
  // Végső sebzés kiszámítása
  let finalDamage = baseDamage;
  if (isCritical) {
    finalDamage = Math.floor(finalDamage * attacker.critMultiplier);
  }
  
  // Védelem figyelembevétele
  if (target.defense > 0) {
    finalDamage = Math.max(1, Math.floor(finalDamage * (1 - target.defense)));
  }
  
  // Sebzés alkalmazása
  target.health = Math.max(0, target.health - finalDamage);
  
  // Effekt megjelenítése
  displayDamageEffect(target === enemy ? 'enemy' : 'player', finalDamage);
  
  // Üzenet naplózása
  if (attacker === player) {
    if (isCritical) {
      logMessage(`Kritikus találat! A Kalandor ${finalDamage} sebzést okozott!`, 'player-action critical');
    } else {
      logMessage(`A Kalandor ${finalDamage} sebzést okozott az alap támadással.`, 'player-action');
    }
  } else {
    if (isCritical) {
      logMessage(`Kritikus találat! A Sötét Nagyúr ${finalDamage} sebzést okozott!`, 'enemy-action critical');
    } else {
      logMessage(`A Sötét Nagyúr ${finalDamage} sebzést okozott az alap támadással.`, 'enemy-action');
    }
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('clash');
  
  // Ellenőrizze, hogy vége van-e a harcnak
  checkBattleEnd();
}

// Védekező akció végrehajtása
function performDefend(character) {
  character.defense = 0.5; // 50% sebzéscsökkentés
  
  // Állapothatás hozzáadása
  addStatusEffect(character, {
    name: 'Védelem',
    icon: 'fas fa-shield-alt',
    duration: 1,
    effect: 'defense',
    value: 0.5
  });
  
  // Üzenet naplózása
  if (character === player) {
    logMessage('A Kalandor védekező állást vesz fel, 50% sebzéscsökkentés a következő támadásra.', 'player-action');
  } else {
    logMessage('A Sötét Nagyúr védekező állást vesz fel, 50% sebzéscsökkentés a következő támadásra.', 'enemy-action');
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('shield');
}

// Koncentráció akció végrehajtása
function performFocus(character) {
  // Mana visszaállítása
  const manaGain = 15;
  character.mana = Math.min(character.maxMana, character.mana + manaGain);
  
  // Kritikus találat esélyének növelése
  const oldCritChance = character.critChance;
  character.critChance += 0.25;
  
  // Állapothatás hozzáadása a kritikus esély növeléséhez
  addStatusEffect(character, {
    name: 'Koncentráció',
    icon: 'fas fa-atom',
    duration: 1,
    effect: 'critBoost',
    value: 0.25,
    onRemove: () => {
      character.critChance = oldCritChance;
    }
  });
  
  // Gyógyulás effekt megjelenítése a mana miatt
  displayHealEffect(character === player ? 'player' : 'enemy', manaGain, true);
  
  // Üzenet naplózása
  if (character === player) {
    logMessage(`A Kalandor koncentrál, visszanyer ${manaGain} manát és növeli a kritikus találat esélyét.`, 'player-action');
  } else {
    logMessage(`A Sötét Nagyúr koncentrál, visszanyer ${manaGain} manát és növeli a kritikus találat esélyét.`, 'enemy-action');
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('focus');
}

// Slash képesség végrehajtása
function performSlash(attacker, target) {
  const damageRange = [15, 20];
  const baseDamage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];
  
  // Kritikus találat esélye
  const isCritical = Math.random() < attacker.critChance;
  
  // Végső sebzés kiszámítása
  let finalDamage = baseDamage;
  if (isCritical) {
    finalDamage = Math.floor(finalDamage * attacker.critMultiplier);
  }
  
  // Védelem figyelembevétele
  if (target.defense > 0) {
    finalDamage = Math.max(1, Math.floor(finalDamage * (1 - target.defense)));
  }
  
  // Sebzés alkalmazása
  target.health = Math.max(0, target.health - finalDamage);
  
  // Effekt megjelenítése
  displayDamageEffect(target === enemy ? 'enemy' : 'player', finalDamage);
  
  // Üzenet naplózása
  if (attacker === player) {
    if (isCritical) {
      logMessage(`Kritikus Pusztító Vágás! A Kalandor ${finalDamage} sebzést okozott!`, 'player-action critical');
    } else {
      logMessage(`A Kalandor Pusztító Vágást használ, ${finalDamage} sebzést okozva.`, 'player-action');
    }
  } else {
    if (isCritical) {
      logMessage(`Kritikus csapás! A Sötét Nagyúr sötét penge technikája ${finalDamage} sebzést okozott!`, 'enemy-action critical');
    } else {
      logMessage(`A Sötét Nagyúr sötét penge technikát használ, ${finalDamage} sebzést okozva.`, 'enemy-action');
    }
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('slash');
  
  // Ellenőrizze, hogy vége van-e a harcnak
  checkBattleEnd();
}

// Heal képesség végrehajtása
function performHeal(character) {
  const healRange = [20, 25];
  const healAmount = Math.floor(Math.random() * (healRange[1] - healRange[0] + 1)) + healRange[0];
  
  // Gyógyítás alkalmazása
  character.health = Math.min(character.maxHealth, character.health + healAmount);
  
  // Effekt megjelenítése
  displayHealEffect(character === player ? 'player' : 'enemy', healAmount);
  
  // Üzenet naplózása
  if (character === player) {
    logMessage(`A Kalandor gyógyító varázslatot használ, és visszanyer ${healAmount} életerőt.`, 'player-action heal');
  } else {
    logMessage(`A Sötét Nagyúr sötét regenerációt használ, és visszanyer ${healAmount} életerőt.`, 'enemy-action heal');
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('heal');
}

// Fireball képesség végrehajtása
function performFireball(attacker, target) {
  const damageRange = [20, 30];
  const baseDamage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];
  
  // Kritikus találat esélye
  const isCritical = Math.random() < attacker.critChance;
  
  // Végső sebzés kiszámítása
  let finalDamage = baseDamage;
  if (isCritical) {
    finalDamage = Math.floor(finalDamage * attacker.critMultiplier);
  }
  
  // Védelem figyelembevétele
  if (target.defense > 0) {
    finalDamage = Math.max(1, Math.floor(finalDamage * (1 - target.defense)));
  }
  
  // Sebzés alkalmazása
  target.health = Math.max(0, target.health - finalDamage);
  
  // Effekt megjelenítése
  displayDamageEffect(target === enemy ? 'enemy' : 'player', finalDamage);
  
  // Égés állapothatás hozzáadása
  const burnChance = 0.25;
  if (Math.random() < burnChance) {
    addStatusEffect(target, {
      name: 'Égés',
      icon: 'fas fa-fire',
      duration: 2,
      effect: 'dot',
      damage: Math.floor(finalDamage * 0.2),
      tickMessage: target === player ? 
        'A Kalandor szenved az égési sérülésektől.' :
        'A Sötét Nagyúr szenved az égési sérülésektől.'
    });
  }
  
  // Üzenet naplózása
  if (attacker === player) {
    if (isCritical) {
      logMessage(`Kritikus Tűzgolyó! A Kalandor ${finalDamage} sebzést okozott!`, 'player-action critical');
    } else {
      logMessage(`A Kalandor Tűzgolyót idéz, ${finalDamage} sebzést okozva.`, 'player-action');
    }
  } else {
    if (isCritical) {
      logMessage(`Kritikus Sötét Nova! A Sötét Nagyúr ${finalDamage} sebzést okozott!`, 'enemy-action critical');
    } else {
      logMessage(`A Sötét Nagyúr Sötét Novát idéz, ${finalDamage} sebzést okozva.`, 'enemy-action');
    }
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('fireball');
  
  // Ellenőrizze, hogy vége van-e a harcnak
  checkBattleEnd();
}

// Stun képesség végrehajtása
function performStun(attacker, target) {
  // Kábítás állapothatás hozzáadása
  addStatusEffect(target, {
    name: 'Kábult',
    icon: 'fas fa-bolt',
    duration: 1,
    effect: 'stunned'
  });
  
  // Üzenet naplózása
  if (attacker === player) {
    logMessage('A Kalandor kábító varázslatot használ, az ellenség kihagy egy kört!', 'player-action');
  } else {
    logMessage('A Sötét Nagyúr sötét bénítást használ, a Kalandor kihagy egy kört!', 'enemy-action');
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('stun');
}

// Démon forma képesség végrehajtása (csak ellenfél)
function performDemonForm(character) {
  // Démoni erő állapothatás hozzáadása
  addStatusEffect(character, {
    name: 'Démoni Erő',
    icon: 'fas fa-dragon',
    duration: 3,
    effect: 'damageBoost',
    value: 0.5
  });
  
  // Üzenet naplózása
  logMessage('A Sötét Nagyúr démoni formát ölt! Sebzése 50%-kal nő a következő 3 körre!', 'enemy-action');
  
  // Animáció a harc ikonon
  animateCombatIcon('transform');
  
  // Újratöltési idő beállítása
  enemy.abilities.demonForm.cooldown = enemy.abilities.demonForm.maxCooldown;
}

// Sötét nyíl képesség végrehajtása (csak ellenfél)
function performDarkBolt(attacker, target) {
  const damageRange = [15, 22];
  const baseDamage = Math.floor(Math.random() * (damageRange[1] - damageRange[0] + 1)) + damageRange[0];
  
  // Kritikus találat esélye
  const isCritical = Math.random() < attacker.critChance;
  
  // Végső sebzés kiszámítása
  let finalDamage = baseDamage;
  if (isCritical) {
    finalDamage = Math.floor(finalDamage * attacker.critMultiplier);
  }
  
  // Sebzésnövelő hatások figyelembe vétele
  const damageBoostEffect = attacker.statusEffects.find(effect => effect.effect === 'damageBoost');
  if (damageBoostEffect) {
    finalDamage = Math.floor(finalDamage * (1 + damageBoostEffect.value));
  }
  
  // Védelem figyelembevétele
  if (target.defense > 0) {
    finalDamage = Math.max(1, Math.floor(finalDamage * (1 - target.defense)));
  }
  
  // Mana elszívás
  const manaDrain = Math.min(10, target.mana);
  target.mana -= manaDrain;
  attacker.mana = Math.min(attacker.maxMana, attacker.mana + manaDrain);
  
  // Sebzés alkalmazása
  target.health = Math.max(0, target.health - finalDamage);
  
  // Effekt megjelenítése
  displayDamageEffect('player', finalDamage);
  
  // Üzenet naplózása
  if (isCritical) {
    logMessage(`Kritikus Sötét Nyíl! A Sötét Nagyúr ${finalDamage} sebzést okozott és elszívott ${manaDrain} manát!`, 'enemy-action critical');
  } else {
    logMessage(`A Sötét Nagyúr Sötét Nyilat lő, ${finalDamage} sebzést okoz és elszív ${manaDrain} manát!`, 'enemy-action');
  }
  
  // Animáció a harc ikonon
  animateCombatIcon('darkbolt');
  
  // Újratöltési idő beállítása
  enemy.abilities.darkBolt.cooldown = enemy.abilities.darkBolt.maxCooldown;
  
  // Ellenőrizze, hogy vége van-e a harcnak
  checkBattleEnd();
}

// Árnyék gyógyítás képesség végrehajtása (csak ellenfél)
function performShadowHeal(character) {
  const healRange = [25, 35];
  const healAmount = Math.floor(Math.random() * (healRange[1] - healRange[0] + 1)) + healRange[0];
  
  // Gyógyítás alkalmazása
  character.health = Math.min(character.maxHealth, character.health + healAmount);
  
  // Démon áldás állapothatás - védekezés növelése
  addStatusEffect(character, {
    name: 'Démon Áldás',
    icon: 'fas fa-heart',
    duration: 2,
    effect: 'temporaryDefense',
    value: 0.25
  });
  
  // Effekt megjelenítése
  displayHealEffect('enemy', healAmount);
  
  // Üzenet naplózása
  logMessage(`A Sötét Nagyúr Árnyék Gyógyítást használ, visszanyer ${healAmount} életerőt és 25% védekező bónuszt kap.`, 'enemy-action heal');
  
  // Animáció a harc ikonon
  animateCombatIcon('shadowheal');
  
  // Újratöltési idő beállítása
  enemy.abilities.shadowHeal.cooldown = enemy.abilities.shadowHeal.maxCooldown;
}

// Ellenséges akciók végrehajtása
function executeEnemyAction(action) {
  switch (action.type) {
    case 'attack':
      performAttack(enemy, player);
      break;
    case 'defend':
      performDefend(enemy);
      break;
    case 'focus':
      performFocus(enemy);
      break;
    case 'darkBolt':
      performDarkBolt(enemy, player);
      break;
    case 'shadowHeal':
      performShadowHeal(enemy);
      break;
    case 'demonForm':
      performDemonForm(enemy);
      break;
  }
}

// Az ellenséges AI döntéshozási logikája
function determineEnemyAction() {
  // Taktikai helyzet értékelése
  const enemyHealthPercent = enemy.health / enemy.maxHealth;
  const playerHealthPercent = player.health / player.maxHealth;
  const enemyManaPercent = enemy.mana / enemy.maxMana;
  
  // Hasznos képességek ellenőrzése
  const canUseDarkBolt = enemy.mana >= 20 && enemy.abilities.darkBolt.cooldown === 0;
  const canUseShadowHeal = enemy.mana >= 25 && enemy.abilities.shadowHeal.cooldown === 0;
  const canUseDemonForm = enemy.mana >= 30 && enemy.abilities.demonForm.cooldown === 0;
  
  // A játékos utolsó körének elemzése
  const lastPlayerAction = player.actionHistory.length > 0 ? 
    player.actionHistory[player.actionHistory.length - 1] : null;
  
  // Az utolsó kapott sebzés ellenőrzése
  let lastDamageTaken = 0;
  if (enemy.actionHistory.length > 0 && enemy.actionHistory[enemy.actionHistory.length - 1].damageTaken) {
    lastDamageTaken = enemy.actionHistory[enemy.actionHistory.length - 1].damageTaken;
  }
  
  // Védekezési threshold a kapott sebzés alapján
  const shouldDefend = lastDamageTaken > (enemy.maxHealth * enemy.tacticalThresholds.defensiveThreshold);
  
  // Döntési logika
  
  // 1. Halálos helyzetben próbáljon gyógyulni
  if (enemyHealthPercent < enemy.tacticalThresholds.lowHealth && canUseShadowHeal) {
    return { type: 'shadowHeal' };
  }
  
  // 2. A játékos egy erős képességet használt, védekezzen
  if (shouldDefend && Math.random() < 0.7) {
    return { type: 'defend' };
  }
  
  // 3. Ha kevés a mana és nem tudunk képességet használni, koncentráljunk
  if (enemyManaPercent < enemy.tacticalThresholds.lowMana && Math.random() < 0.8) {
    return { type: 'focus' };
  }
  
  // 4. Támadási lehetőségek, a helyzettől függően
  
  // Ha a bot jól áll, és a játékos kevés életerővel rendelkezik, támadjon keményen
  if (playerHealthPercent < enemy.tacticalThresholds.lowHealth && canUseDarkBolt) {
    return { type: 'darkBolt' };
  }
  
  // Démoni formát használjon, ha a bot élete közepes, de kell az extra erő
  if (enemyHealthPercent < enemy.tacticalThresholds.mediumHealth && enemyHealthPercent > enemy.tacticalThresholds.lowHealth && canUseDemonForm) {
    return { type: 'demonForm' };
  }
  
  // Ha a bot kevesebb életerővel rendelkezik mint a játékos és van képesség, használja azt
  if (enemyHealthPercent < playerHealthPercent) {
    if (canUseDarkBolt && Math.random() < 0.7) {
      return { type: 'darkBolt' };
    } else if (canUseDemonForm && Math.random() < 0.6) {
      return { type: 'demonForm' };
    }
  }
  
  // Alapvető harci taktikák
  
  // 70% esély, hogy alap támadást használ
  if (Math.random() < 0.7) {
    return { type: 'attack' };
  }
  
  // 20% esély, hogy védekezik
  if (Math.random() < 0.2) {
    return { type: 'defend' };
  }
  
  // 10% esély, hogy koncentrál
  return { type: 'focus' };
}

// Állapothatás ellenőrzése
function hasStatusEffect(character, effectType) {
  return character.statusEffects.some(effect => effect.effect === effectType && effect.duration > 0);
}

// Állapothatás hozzáadása
function addStatusEffect(character, effect) {
  // Azonos típusú hatás ellenőrzése
  const existingEffect = character.statusEffects.find(e => e.effect === effect.effect);
  
  if (existingEffect) {
    // Ha ugyanaz a hatás már létezik, töröljük
    const index = character.statusEffects.indexOf(existingEffect);
    // Eltávolítás előtt az onRemove callback futtatása, ha van
    if (existingEffect.onRemove) {
      existingEffect.onRemove();
    }
    character.statusEffects.splice(index, 1);
  }
  
  // Új hatás hozzáadása
  character.statusEffects.push(effect);
}

// Állapothatások feldolgozása
function processStatusEffects(character) {
  const effectsToRemove = [];
  
  character.statusEffects.forEach((effect, index) => {
    // Hatás időtartam csökkentése
    effect.duration--;
    
    // Hatás aktiválása
    if (effect.effect === 'dot' && effect.duration >= 0) {
      // Sebzés idővel (Dot)
      character.health = Math.max(0, character.health - effect.damage);
      
      // Dot effekt megjelenítése
      displayDamageEffect(character === player ? 'player' : 'enemy', effect.damage);
      
      // Üzenet naplózása
      if (effect.tickMessage) {
        logMessage(effect.tickMessage);
      }
      
      // Ellenőrizze, hogy vége van-e a harcnak
      checkBattleEnd();
    }
    else if (effect.effect === 'temporaryDefense' && effect.duration >= 0) {
      // Ideiglenes védelem beállítása, ha még nem történt meg
      if (character.defense < effect.value) {
        character.defense = effect.value;
      }
    }
    
    // Hatások eltávolítása, amikor lejártak
    if (effect.duration < 0) {
      effectsToRemove.push(index);
      
      // Specifikus hatások törlése
      if (effect.effect === 'defense') {
        character.defense = 0;
      }
      
      // onRemove callback hívása, ha van
      if (effect.onRemove) {
        effect.onRemove();
      }
    }
  });
  
  // Hatások törlése fordított sorrendben
  for (let i = effectsToRemove.length - 1; i >= 0; i--) {
    character.statusEffects.splice(effectsToRemove[i], 1);
  }
}

// Harc végének ellenőrzése
function checkBattleEnd() {
  if (player.health <= 0) {
    gameActive = false;
    
    // A játékos vesztett
    messageElement.innerHTML = `<span class="winner">A Sötét Nagyúr legyőzött! Elbukott a küldetésed.</span>`;
    logMessage("A Sötét Nagyúr győzedelmeskedett. A harc véget ért.", "enemy-action");
    
    // Gombok letiltása
    disableAllButtons();
    
    // Reset gomb megjelenítése
    resetContainerElement.style.display = 'block';
  }
  else if (enemy.health <= 0) {
    gameActive = false;
    
    // A játékos nyert
    messageElement.innerHTML = `<span class="winner">Győzelem! Legyőzted a Sötét Nagyurat!</span>`;
    logMessage("A Kalandor győzedelmeskedett. A harc véget ért.", "player-action");
    
    // Gombok letiltása
    disableAllButtons();
    
    // Reset gomb megjelenítése
    resetContainerElement.style.display = 'block';
  }
}

// Sebzés effekt megjelenítése
function displayDamageEffect(target, amount) {
  const element = document.getElementById(target === 'player' ? 'playerSection' : 'enemySection');
  const damageElement = document.createElement('div');
  damageElement.className = 'damage';
  damageElement.textContent = `-${amount}`;
  
  // Pozicionálás véletlenszerűen az elemen belül
  damageElement.style.top = `${Math.random() * 50 + 25}%`;
  damageElement.style.left = `${Math.random() * 50 + 25}%`;
  
  element.appendChild(damageElement);
  
  // Törlés az animáció után
  setTimeout(() => {
    element.removeChild(damageElement);
  }, 1000);
}

// Gyógyítás effekt megjelenítése
function displayHealEffect(target, amount, isMana = false) {
  const element = document.getElementById(target === 'player' ? 'playerSection' : 'enemySection');
  const healElement = document.createElement('div');
  healElement.className = 'heal-anim';
  healElement.textContent = `+${amount}`;
  healElement.style.color = isMana ? '#1f5a9e' : '#00ff00';
  
  // Pozicionálás véletlenszerűen az elemen belül
  healElement.style.top = `${Math.random() * 50 + 25}%`;
  healElement.style.left = `${Math.random() * 50 + 25}%`;
  
  element.appendChild(healElement);
  
  // Törlés az animáció után
  setTimeout(() => {
    element.removeChild(healElement);
  }, 1000);
}

// Harc ikon animálása
function animateCombatIcon(iconType) {
  switch (iconType) {
    case 'clash':
      combatIconElement.innerHTML = '<i class="fas fa-swords"></i>';
      break;
    case 'shield':
      combatIconElement.innerHTML = '<i class="fas fa-shield-alt"></i>';
      break;
    case 'focus':
      combatIconElement.innerHTML = '<i class="fas fa-atom"></i>';
      break;
    case 'slash':
      combatIconElement.innerHTML = '<i class="fas fa-wind"></i>';
      break;
    case 'heal':
      combatIconElement.innerHTML = '<i class="fas fa-heart"></i>';
      break;
    case 'fireball':
      combatIconElement.innerHTML = '<i class="fas fa-fire-alt"></i>';
      break;
    case 'stun':
      combatIconElement.innerHTML = '<i class="fas fa-bolt"></i>';
      break;
    case 'transform':
      combatIconElement.innerHTML = '<i class="fas fa-dragon"></i>';
      break;
    case 'darkbolt':
      combatIconElement.innerHTML = '<i class="fas fa-moon"></i>';
      break;
    case 'shadowheal':
      combatIconElement.innerHTML = '<i class="fas fa-skull"></i>';
      break;
    default:
      combatIconElement.innerHTML = '<i class="fas fa-swords"></i>';
  }
  
  // Animáció effekt
  combatIconElement.classList.remove('combat-icon');
  void combatIconElement.offsetWidth;
  combatIconElement.classList.add('combat-icon');
}

// Üzenet naplózása
function logMessage(message, className = '') {
  const logEntry = document.createElement('p');
  logEntry.className = className;
  logEntry.textContent = message;
  
  battleLogElement.appendChild(logEntry);
  
  // Automatikus görgetés az új üzenethez
  battleLogElement.scrollTop = battleLogElement.scrollHeight;
}

// Összes gomb letiltása
function disableAllButtons() {
  document.getElementById('attackBtn').disabled = true;
  document.getElementById('defendBtn').disabled = true;
  document.getElementById('focusBtn').disabled = true;
  document.getElementById('slashBtn').disabled = true;
  document.getElementById('healBtn').disabled = true;
  document.getElementById('fireballBtn').disabled = true;
  document.getElementById('stunBtn').disabled = true;
}

// Összes gomb engedélyezése
function enableAllButtons() {
  document.getElementById('attackBtn').disabled = false;
  document.getElementById('defendBtn').disabled = false;
  document.getElementById('focusBtn').disabled = false;
  document.getElementById('slashBtn').disabled = false;
  document.getElementById('healBtn').disabled = false;
  document.getElementById('fireballBtn').disabled = false;
  document.getElementById('stunBtn').disabled = false;
}

// Játék indítása
startGame();
</script>

</body>
</html>
