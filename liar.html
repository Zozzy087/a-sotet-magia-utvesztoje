<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Kalózkocka</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Cinzel', serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #ffffff;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      background-color: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 0 15px rgba(127, 0, 255, 0.7);
      text-align: center;
    }
    #turnInfo, #result, #score {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 5px;
      margin: 10px auto;
      box-shadow: 0 0 10px rgba(127, 0, 255, 0.4);
      text-align: center;
      width: 100%;
      max-width: 500px;
    }
    button {
      background-color: #7f00ff;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 10px #7f00ff;
      transition: transform 0.2s, box-shadow 0.3s;
    }
    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px #a94bff;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .dice-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px auto;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(127, 0, 255, 0.5);
      width: 100%;
      max-width: 500px;
    }
    .dice {
      width: 60px;
      height: 60px;
      background-color: #f1f1f1;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      font-size: 2rem;
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }
    .hidden-dice {
      background-color: #7f00ff;
      color: #7f00ff; /* Elrejtjük a számot */
    }
    .show-all .hidden-dice {
      background-color: #f1f1f1;
      color: #333;
    }
    .bid-controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 15px auto;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(127, 0, 255, 0.5);
      width: 100%;
      max-width: 500px;
    }
    .bid-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }
    .bid-label {
      min-width: 100px;
      text-align: left;
    }
    .quantity-controls, .value-controls {
      display: flex;
      gap: 5px;
      align-items: center;
    }
    .quantity-display, .value-display {
      background-color: rgba(0, 0, 0, 0.5);
      padding: 5px 15px;
      border-radius: 5px;
      min-width: 60px;
      text-align: center;
    }
    .action-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
    }
    #resetContainer {
      margin-top: 20px;
      display: none;
    }
    #result:empty {
      display: none;
    }
    .history {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px 15px;
      border-radius: 5px;
      margin: 10px auto;
      box-shadow: 0 0 10px rgba(127, 0, 255, 0.4);
      width: 100%;
      max-width: 500px;
      max-height: 150px;
      overflow-y: auto;
    }
    .history-item {
      margin: 5px 0;
      font-size: 0.9rem;
    }
    .player-name {
      font-weight: bold;
      color: #a94bff;
    }
    
    /* Reszponzív stílusok */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.8rem;
        padding: 8px 15px;
      }
      .dice {
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
      }
      .bid-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
  <!-- Font Awesome ikonokhoz -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<h1>Kalózkocka (Perudo)</h1>

<p id="turnInfo">A játék kezdődik!</p>
<h3 id="score">Kockák: Játékos - 5 | AI - 5</h3>

<div class="dice-area" id="player-dice">
  <h3>A Te kockáid</h3>
  <!-- Itt jelennek meg a játékos kockái -->
</div>

<div class="dice-area" id="ai-dice">
  <h3>Ellenfél kockái</h3>
  <!-- Itt jelennek meg az AI kockái (rejtve) -->
</div>

<div class="bid-controls" id="bid-controls">
  <div class="bid-row">
    <span class="bid-label">Mennyiség:</span>
    <div class="quantity-controls">
      <button id="quantity-minus" onclick="adjustQuantity(-1)">-</button>
      <span class="quantity-display" id="quantity-display">1</span>
      <button id="quantity-plus" onclick="adjustQuantity(1)">+</button>
    </div>
  </div>
  <div class="bid-row">
    <span class="bid-label">Érték:</span>
    <div class="value-controls">
      <button id="value-minus" onclick="adjustValue(-1)">-</button>
      <span class="value-display" id="value-display">1</span>
      <button id="value-plus" onclick="adjustValue(1)">+</button>
    </div>
  </div>
  <div class="action-buttons">
    <button id="bid-button" onclick="placeBid()">Licit</button>
    <button id="dudo-button" onclick="callDudo()" disabled>Blöff!</button>
  </div>
</div>

<div class="history" id="history">
  <h3>Licitek</h3>
  <!-- Itt jelennek meg a korábbi licitek -->
</div>

<h2 id="result"></h2>

<div id="resetContainer">
  <button onclick="startGame()">Új játék</button>
</div>

<script>
// Játék alapállapota
let playerDice = [];
let aiDice = [];
let currentPlayer = 'player'; // 'player' vagy 'ai'
let lastBid = null;
let gameInProgress = true;
let currentQuantity = 1;
let currentValue = 1;
let playerDiceCount = 5;
let aiDiceCount = 5;
let totalDiceCount = 10;

// Játék indítása
function startGame() {
  // Alapértékek beállítása
  playerDice = [];
  aiDice = [];
  currentPlayer = 'player';
  lastBid = null;
  gameInProgress = true;
  currentQuantity = 1;
  currentValue = 1;
  playerDiceCount = 5;
  aiDiceCount = 5;
  totalDiceCount = 10;
  
  // UI elemek visszaállítása
  document.getElementById("result").textContent = "";
  document.getElementById("turnInfo").textContent = "Te kezdesz! Tégy egy licitet.";
  document.getElementById("score").textContent = `Kockák: Játékos - ${playerDiceCount} | AI - ${aiDiceCount}`;
  document.getElementById("history").innerHTML = "<h3>Licitek</h3>";
  document.getElementById("resetContainer").style.display = "none";
  document.getElementById("quantity-display").textContent = "1";
  document.getElementById("value-display").textContent = "1";
  
  // Gombok beállítása
  document.getElementById("bid-button").disabled = false;
  document.getElementById("dudo-button").disabled = true;
  
  // Kockák dobása
  rollDice();
  
  // Kockák megjelenítése
  renderDice();
  
  // Vezérlők beállítása
  updateControls();
}

// Kockák dobása
function rollDice() {
  playerDice = [];
  aiDice = [];
  
  // Játékos kockáinak dobása
  for (let i = 0; i < playerDiceCount; i++) {
    playerDice.push(Math.floor(Math.random() * 6) + 1);
  }
  
  // AI kockáinak dobása
  for (let i = 0; i < aiDiceCount; i++) {
    aiDice.push(Math.floor(Math.random() * 6) + 1);
  }
}

// Kockák megjelenítése
function renderDice() {
  const playerDiceArea = document.getElementById("player-dice");
  const aiDiceArea = document.getElementById("ai-dice");
  
  // Játékos kockái
  let playerDiceHTML = "<h3>A Te kockáid</h3>";
  playerDice.forEach(dice => {
    playerDiceHTML += `<div class="dice">${getDiceIcon(dice)}</div>`;
  });
  playerDiceArea.innerHTML = playerDiceHTML;
  
  // AI kockái (rejtve)
  let aiDiceHTML = "<h3>Ellenfél kockái</h3>";
  aiDice.forEach(dice => {
    aiDiceHTML += `<div class="dice hidden-dice">${getDiceIcon(dice)}</div>`;
  });
  aiDiceArea.innerHTML = aiDiceHTML;
}

// Kocka ikon lekérése
function getDiceIcon(value) {
  const icons = {
    1: '<i class="fas fa-dice-one"></i>',
    2: '<i class="fas fa-dice-two"></i>',
    3: '<i class="fas fa-dice-three"></i>',
    4: '<i class="fas fa-dice-four"></i>',
    5: '<i class="fas fa-dice-five"></i>',
    6: '<i class="fas fa-dice-six"></i>'
  };
  return icons[value];
}

// Licit mennyiség állítása
function adjustQuantity(change) {
  const min = 1;
  const max = totalDiceCount;
  
  // Ha van előző licit, akkor annak függvényében állítjuk a minimum értéket
  if (lastBid) {
    if (currentValue > lastBid.value) {
      // Ha nagyobb értéket választottunk, lehet kevesebb a mennyiség
      currentQuantity = Math.max(min, Math.min(max, currentQuantity + change));
    } else if (currentValue === lastBid.value) {
      // Ha ugyanaz az érték, a mennyiségnek nagyobbnak kell lennie
      currentQuantity = Math.max(lastBid.quantity + 1, Math.min(max, currentQuantity + change));
    } else {
      // Ha kisebb az érték, akkor nem lehet érvényes licit
      currentQuantity = Math.max(lastBid.quantity + 1, Math.min(max, currentQuantity + change));
    }
  } else {
    currentQuantity = Math.max(min, Math.min(max, currentQuantity + change));
  }
  
  document.getElementById("quantity-display").textContent = currentQuantity;
  updateControls();
}

// Licit érték állítása
function adjustValue(change) {
  const min = 1;
  const max = 6;
  
  currentValue = Math.max(min, Math.min(max, currentValue + change));
  document.getElementById("value-display").textContent = currentValue;
  updateControls();
}

// Vezérlők frissítése az aktuális játékállapot szerint
function updateControls() {
  const quantityMinus = document.getElementById("quantity-minus");
  const quantityPlus = document.getElementById("quantity-plus");
  const valueMinus = document.getElementById("value-minus");
  const valuePlus = document.getElementById("value-plus");
  const bidButton = document.getElementById("bid-button");
  const dudoButton = document.getElementById("dudo-button");
  
  // Csak a játékos köre esetén aktívak a gombok
  const isPlayerTurn = currentPlayer === 'player';
  quantityMinus.disabled = !isPlayerTurn;
  quantityPlus.disabled = !isPlayerTurn;
  valueMinus.disabled = !isPlayerTurn;
  valuePlus.disabled = !isPlayerTurn;
  bidButton.disabled = !isPlayerTurn;
  
  // Dudo gomb csak akkor aktív, ha van előző licit
  dudoButton.disabled = !isPlayerTurn || !lastBid;
  
  // Ellenőrizzük, hogy a licit érvényes-e
  if (lastBid) {
    const isValidBid = 
      (currentValue > lastBid.value) || 
      (currentValue === lastBid.value && currentQuantity > lastBid.quantity);
    
    bidButton.disabled = !isPlayerTurn || !isValidBid;
  }
  
  // Min-max gombok letiltása, ha elértük a határokat
  quantityMinus.disabled = !isPlayerTurn || currentQuantity <= 1;
  quantityPlus.disabled = !isPlayerTurn || currentQuantity >= totalDiceCount;
  valueMinus.disabled = !isPlayerTurn || currentValue <= 1;
  valuePlus.disabled = !isPlayerTurn || currentValue >= 6;
}

// Licit leadása
function placeBid() {
  if (currentPlayer !== 'player') return;
  
  // Licit rögzítése
  lastBid = {
    player: 'player',
    quantity: currentQuantity,
    value: currentValue
  };
  
  // Licit hozzáadása a történethez
  addToHistory('player', currentQuantity, currentValue);
  
  // Játékos váltás
  currentPlayer = 'ai';
  document.getElementById("turnInfo").textContent = "AI gondolkodik...";
  
  // Vezérlők frissítése
  updateControls();
  
  // AI körének szimulálása késleltetéssel
  setTimeout(aiTurn, 1500);
}

// AI köre
function aiTurn() {
  if (currentPlayer !== 'ai') return;
  
  // AI döntés: licit vagy blöff
  const aiDecision = makeAiDecision();
  
  if (aiDecision.action === 'bid') {
    // AI licitál
    lastBid = {
      player: 'ai',
      quantity: aiDecision.quantity,
      value: aiDecision.value
    };
    
    // Licit hozzáadása a történethez
    addToHistory('ai', aiDecision.quantity, aiDecision.value);
    
    // Frissítjük az aktuális értékeket a játékos számára
    currentQuantity = aiDecision.quantity;
    currentValue = aiDecision.value;
    document.getElementById("quantity-display").textContent = currentQuantity;
    document.getElementById("value-display").textContent = currentValue;
    
    // Játékos váltás
    currentPlayer = 'player';
    document.getElementById("turnInfo").textContent = "Te következel! Licitálj vagy mondj blöfföt.";
    
  } else {
    // AI blöfföt mond
    callDudo('ai');
    return;
  }
  
  // Vezérlők frissítése
  updateControls();
}

// AI döntéshozatal
function makeAiDecision() {
  if (!lastBid) {
    // Ha nincs előző licit, akkor az AI kezdi
    return decideBestFirstBid();
  }
  
  // Kockák összeszámolása a TELJES készletre
  const countAllDice = countDiceValues([...aiDice, ...playerDice]);
  
  // Az előző licit értékének számolása, az 1-esek jokerek
  const actualDiceWithValue = countActualDiceWithValue(lastBid.value);
  
  // Ha a licit nagyon valószínűtlen, érdemes blöfföt mondani
  if (lastBid.quantity > (actualDiceWithValue + 1)) {
    // A valószínűsége, hogy blöfföt mond, a licit túlzottságától függ
    const bluffChance = Math.min(0.8, (lastBid.quantity - actualDiceWithValue) / totalDiceCount);
    
    if (Math.random() < bluffChance) {
      return { action: 'dudo' };
    }
  }
  
  // Különben az AI licitál
  return decideNextBid();
  
  // AI segédfüggvények
  
  // Kezdő licit döntése
  function decideBestFirstBid() {
    // AI saját kockáinak számlálása
    const aiDiceCounts = countDiceValues(aiDice);
    
    // A leggyakoribb érték megtalálása
    let maxCount = 0;
    let bestValue = 1;
    
    for (let i = 1; i <= 6; i++) {
      const count = aiDiceCounts[i] || 0;
      if (count > maxCount) {
        maxCount = count;
        bestValue = i;
      }
    }
    
    // Óvatos licit: a saját leggyakoribb értékből kicsit több
    const quantity = Math.max(1, maxCount + Math.floor(Math.random() * 2));
    
    return {
      action: 'bid',
      quantity: quantity,
      value: bestValue
    };
  }
  
  // Következő licit döntése
  function decideNextBid() {
    // Előző licit megemelése
    let newQuantity = lastBid.quantity;
    let newValue = lastBid.value;
    
    // AI próbálja becsülni a teljes asztalon lévő kockák számát az adott értékkel
    const aiDiceCounts = countDiceValues(aiDice);
    const aiCount = aiDiceCounts[lastBid.value] || 0;
    const oneCount = aiDiceCounts[1] || 0; // Az egyesek jokerek
    
    // Becsült darabszám: saját + várt (játékostól)
    const estimatedCount = Math.floor((aiCount + oneCount) * (totalDiceCount / aiDiceCount));
    
    // Stratégia: ha túl magasnak tűnik a mennyiség, inkább növeljük az értéket
    if (lastBid.quantity >= estimatedCount + 1) {
      newValue = lastBid.value + 1;
      if (newValue > 6) newValue = 2; // 1-re nem licitálunk, mert az joker
      newQuantity = Math.max(1, Math.floor(lastBid.quantity * 0.7)); // Csökkentjük a mennyiséget
    } else {
      // Különben növeljük a mennyiséget
      newQuantity = lastBid.quantity + 1;
    }
    
    // Biztosítjuk, hogy a licit érvényes legyen
    if (newValue === lastBid.value) {
      newQuantity = Math.max(lastBid.quantity + 1, newQuantity);
    } else if (newValue < lastBid.value) {
      newQuantity = Math.max(lastBid.quantity + 1, newQuantity);
    }
    
    return {
      action: 'bid',
      quantity: newQuantity,
      value: newValue
    };
  }
  
  // Kocka értékek számolása
  function countDiceValues(diceArray) {
    const counts = {};
    diceArray.forEach(dice => {
      counts[dice] = (counts[dice] || 0) + 1;
    });
    return counts;
  }
}

// A tényleges kockák számolása egy adott értékkel (1-esek jokerként számítanak)
function countActualDiceWithValue(value) {
  // Megszámoljuk a megadott értékű kockákat + a jokereket (1-esek)
  const allDice = [...playerDice, ...aiDice];
  let count = 0;
  
  allDice.forEach(dice => {
    if (dice === value || dice === 1) {
      count++;
    }
  });
  
  return count;
}

// Blöff (dudo) hívása
function callDudo(caller = 'player') {
  if (!lastBid) return;
  
  // Kockák felfedése
  document.getElementById("ai-dice").classList.add("show-all");
  
  // Megszámoljuk a ténylegesen meglévő kockákat az adott értékkel
  const actualCount = countActualDiceWithValue(lastBid.value);
  
  // Blöff eredményének meghatározása
  const lastBidder = lastBid.player;
  const isDudo = actualCount < lastBid.quantity;
  
  let resultText = "";
  let loser = "";
  
  if (isDudo) {
    // A blöff sikeres volt, az előző licitáló veszít
    loser = lastBidder;
    resultText = `Blöff! ${lastBidder === 'player' ? 'Te blöfföltél' : 'Az AI blöffölt'}. ${actualCount} db ${lastBid.value}-es volt (a licit ${lastBid.quantity} db volt).`;
  } else {
    // A blöff nem volt sikeres, a blöfföt mondó veszít
    loser = caller;
    resultText = `Nem blöff! ${lastBidder === 'player' ? 'Te igazat mondtál' : 'Az AI igazat mondott'}. ${actualCount} db ${lastBid.value}-es volt (a licit ${lastBid.quantity} db volt).`;
  }
  
  // Vesztes kockáinak csökkentése
  if (loser === 'player') {
    playerDiceCount--;
  } else {
    aiDiceCount--;
  }
  
  // Játék végének ellenőrzése
  if (playerDiceCount === 0 || aiDiceCount === 0) {
    // Játék vége
    gameInProgress = false;
    
    if (playerDiceCount === 0) {
      resultText += "<br><span class='winner'>Az AI nyert!</span>";
    } else {
      resultText += "<br><span class='winner'>Te nyertél!</span>";
    }
    
    document.getElementById("resetContainer").style.display = "block";
  }
  
  // Eredmény kijelzése
  document.getElementById("result").innerHTML = resultText;
  document.getElementById("score").textContent = `Kockák: Játékos - ${playerDiceCount} | AI - ${aiDiceCount}`;
  
  // Ha a játék még folytatódik, új kört kezdünk
  if (gameInProgress) {
    setTimeout(() => {
      // Új kör indítása
      startNewRound(loser === 'player' ? 'ai' : 'player');
    }, 3000);
  }
}

// Új kör indítása
function startNewRound(firstPlayer) {
  // Kockák elrejtése
  document.getElementById("ai-dice").classList.remove("show-all");
  
  // Kockák újradobása
  rollDice();
  
  // Kockák megjelenítése
  renderDice();
  
  // Alapértékek beállítása
  currentPlayer = firstPlayer;
  lastBid = null;
  currentQuantity = 1;
  currentValue = 1;
  totalDiceCount = playerDiceCount + aiDiceCount;
  
  // UI frissítése
  document.getElementById("result").textContent = "";
  document.getElementById("quantity-display").textContent = "1";
  document.getElementById("value-display").textContent = "1";
  
  // Játékállapot kijelzése
  if (currentPlayer === 'player') {
    document.getElementById("turnInfo").textContent = "Te kezdesz! Tégy egy licitet.";
  } else {
    document.getElementById("turnInfo").textContent = "AI gondolkodik...";
    setTimeout(aiTurn, 1500);
  }
  
  // Vezérlők frissítése
  updateControls();
}

// Licit hozzáadása a történethez
function addToHistory(player, quantity, value) {
  const history = document.getElementById("history");
  const newItem = document.createElement("div");
  newItem.className = "history-item";
  newItem.innerHTML = `<span class="player-name">${player === 'player' ? 'Te' : 'AI'}</span>: ${quantity} db ${value}-es`;
  
  // Az új elem az elején jelenjen meg
  const historyTitle = history.querySelector("h3");
  history.insertBefore(newItem, historyTitle.nextSibling);
  
  // Görgetés az elejére
  history.scrollTop = 0;
}

// Játék indítása
startGame();
</script>
</body>
</html>
