<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Loki Hazudós Kockajátéka</title>
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: "Eczar", serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      color: #d1c3af;
      margin: 0;
      padding: 20px;
      text-align: center;
      background-color: #0c0c0c;
    }
    h1 {
      font-size: 2.6rem;
      margin-bottom: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      text-shadow: 0 0 10px #ff6400;
      letter-spacing: 2px;
    }
    #gameArea {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      margin: 20px 0;
    }
    .player-section {
      background-color: rgba(20, 14, 10, 0.85);
      padding: 20px;
      border-radius: 5px;
      min-width: 260px;
      border: 1px solid #482c17;
      transition: all 0.3s ease;
      position: relative;
    }
    .active-player {
      border: 3px solid #ff6400;
      box-shadow: 0 0 25px rgba(255, 100, 0, 0.7);
      transform: scale(1.05);
      z-index: 2;
    }
    .active-player::before {
      content: "》";
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    .active-player::after {
      content: "《";
      position: absolute;
      right: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    h2 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #d1c3af;
    }
    .sparks-container {
      margin: 15px 0;
    }
    .spark {
      display: inline-block;
      font-size: 2rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      margin: 0 5px;
    }
    .lost-spark {
      color: #482c17;
      text-shadow: none;
    }
    .dice-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }
    .dice {
      position: relative;
      font-size: 3.5rem;
      width: 70px;
      height: 70px;
      line-height: 70px;
      background-color: #291d14;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.3);
      color: #d1c3af;
      animation-duration: 0.8s;
      animation-timing-function: ease-out;
      animation-fill-mode: forwards;
    }
    .dice-roll-1 {
      animation-name: rollDice1;
    }
    .dice-roll-2 {
      animation-name: rollDice2;
    }
    @keyframes rollDice1 {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(720deg) rotateX(360deg); }
      100% { transform: rotateY(1440deg) rotateX(720deg); }
    }
    @keyframes rollDice2 {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(720deg) rotateX(-360deg); }
      100% { transform: rotateY(1440deg) rotateX(-720deg); }
    }
    .hidden-dice {
      display: none;
    }
    .current-claim {
      font-size: 1.6rem;
      font-weight: bold;
      margin: 15px 0;
      background-color: rgba(72, 44, 23, 0.6);
      padding: 10px;
      border-radius: 5px;
      display: inline-block;
    }
    #controls {
      margin-top: 20px;
    }
    .action-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    button {
      font-family: "Eczar", serif;
      font-size: 1.2rem;
      padding: 12px 20px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #482c17;
      color: #d1c3af;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      transition: all 0.3s;
      letter-spacing: 1px;
    }
    button:hover:not(:disabled) {
      background-color: #5a381f;
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.5);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #result {
      font-size: 1.3rem;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      margin-top: 20px;
      max-width: 80%;
      letter-spacing: 1px;
      line-height: 1.4;
    }
    #resetContainer {
      display: none;
      margin-top: 30px;
    }
    .winner {
      color: #ff6400;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 100, 0, 0.7);
    }
    .symbol-legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 10px;
      border-radius: 5px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    .rules-container {
      text-align: left;
      padding: 0 20px;
    }
    .rules-container h3 {
      color: #ff6400;
      margin-bottom: 5px;
    }
    .rules-container p {
      margin-top: 0;
      margin-bottom: 10px;
    }
    .claim-select {
      background-color: #291d14;
      color: #d1c3af;
      border: 1px solid #482c17;
      padding: 10px;
      font-size: 1.1rem;
      font-family: "Eczar", serif;
      border-radius: 5px;
      width: 150px;
      margin: 0 10px;
      cursor: pointer;
    }
    .claim-select option {
      background-color: #291d14;
    }
  </style>
</head>
<body>

<h1>Loki Hazudós Kockajátéka</h1>

<div class="symbol-legend">
  <div class="rules-container">
    <h3>Játékszabályok:</h3>
    <p>• 3 isteni szikrával (életponttal) kezdesz.</p>
    <p>• Két kockával dobsz egyszerre, az ellenfél nem látja az eredményt.</p>
    <p>• A dobott értéket olyan formában olvasd, hogy a nagyobb szám kerül a tízesek helyére (pl. 4 és 5 dobás = 54).</p>
    <p>• Ha ugyanolyan számot dobsz, az "Fortély" (pl. két 6-os = 6-os Fortély).</p>
    <p>• A legerősebb dobás a "Csínytevés" (2-1 dobás = 21).</p>
    <p>• Bejelentheted a valós dobásod, vagy hazudhatsz. De mindig magasabb értéket kell mondanod, mint a korábbi!</p>
    <p>• Az ellenfél vagy elhiszi (és folytatja), vagy nem hiszi el (és akkor fel kell fedned a kockáidat).</p>
    <p>• Aki téved, az veszít egy szikrát. Akinek elfogy az összes szikrája, veszít.</p>
  </div>
</div>

<div id="gameArea">
  <div id="playerSection" class="player-section active-player">
    <h2>Loki (Te)</h2>
    <div class="sparks-container" id="playerSparks">
      <i class="fas fa-fire spark"></i>
      <i class="fas fa-fire spark"></i>
      <i class="fas fa-fire spark"></i>
    </div>
    <div class="dice-container">
      <div id="playerDice1" class="dice">
        <i class="fas fa-dice-one"></i>
      </div>
      <div id="playerDice2" class="dice">
        <i class="fas fa-dice-one"></i>
      </div>
    </div>
  </div>
  
  <div id="gameInfo">
    <div id="currentClaim" class="current-claim">Bejelentett érték: Nincs</div>
    <div id="controls">
      <div id="rollControls" class="action-row">
        <button id="rollBtn" onclick="rollDice()">Dobj a kockákkal!</button>
      </div>
      <div id="claimControls" class="action-row" style="display: none;">
        <select id="claimSelect" class="claim-select">
          <!-- Options will be filled dynamically -->
        </select>
        <button id="claimBtn" onclick="makeClaim()">Bejelentés</button>
      </div>
      <div id="responseControls" class="action-row" style="display: none;">
        <button id="believeBtn" onclick="believe()">Elhiszem</button>
        <button id="doubtBtn" onclick="doubt()">Nem hiszem el</button>
      </div>
    </div>
  </div>
  
  <div id="botSection" class="player-section">
    <h2>Sötét Nagyúr</h2>
    <div class="sparks-container" id="botSparks">
      <i class="fas fa-fire spark"></i>
      <i class="fas fa-fire spark"></i>
      <i class="fas fa-fire spark"></i>
    </div>
    <div class="dice-container">
      <div id="botDice1" class="dice hidden-dice">
        <i class="fas fa-dice-one"></i>
      </div>
      <div id="botDice2" class="dice hidden-dice">
        <i class="fas fa-dice-one"></i>
      </div>
    </div>
  </div>
</div>

<div id="result">A játék kezdetén Loki a kezdő játékos. Dobj a kockákkal!</div>

<div id="resetContainer">
  <button onclick="startGame()">Új Kihívás</button>
</div>

<script>
// Játék konstansok
const MAX_SPARKS = 3;

// Játék változók
let playerSparks = MAX_SPARKS;
let botSparks = MAX_SPARKS;
let activePlayer = 'player'; // 'player' vagy 'bot'
let gameActive = true;
let currentDice = [1, 1]; // [első kocka, második kocka]
let lastClaim = null; // Utolsó bejelentett érték
let isNewRound = true; // Új kör kezdődik-e (ilyenkor bármit lehet mondani)

// Értékek rangsora
const valueRanking = [
  '31', '32', '41', '42', '43', '51', '52', '53', '54', '61', '62', '63', '64', '65',
  'f1', 'f2', 'f3', 'f4', 'f5', 'f6', '21'
];

// Értékek megjelenítéséhez
const valueNames = {
  '31': '31', '32': '32', '41': '41', '42': '42', '43': '43', 
  '51': '51', '52': '52', '53': '53', '54': '54', 
  '61': '61', '62': '62', '63': '63', '64': '64', '65': '65',
  'f1': '1-es Fortély', 'f2': '2-es Fortély', 'f3': '3-as Fortély', 
  'f4': '4-es Fortély', 'f5': '5-ös Fortély', 'f6': '6-os Fortély',
  '21': 'Csínytevés (21)'
};

// DOM elemek
const playerDice1 = document.getElementById('playerDice1');
const playerDice2 = document.getElementById('playerDice2');
const botDice1 = document.getElementById('botDice1');
const botDice2 = document.getElementById('botDice2');
const playerSparksEl = document.getElementById('playerSparks');
const botSparksEl = document.getElementById('botSparks');
const resultEl = document.getElementById('result');
const currentClaimEl = document.getElementById('currentClaim');
const claimSelectEl = document.getElementById('claimSelect');
const rollControlsEl = document.getElementById('rollControls');
const claimControlsEl = document.getElementById('claimControls');
const responseControlsEl = document.getElementById('responseControls');
const playerSectionEl = document.getElementById('playerSection');
const botSectionEl = document.getElementById('botSection');

// Játék indítása
function startGame() {
  // Állapot alaphelyzetbe állítása
  playerSparks = MAX_SPARKS;
  botSparks = MAX_SPARKS;
  activePlayer = 'player';
  gameActive = true;
  currentDice = [1, 1];
  lastClaim = null;
  isNewRound = true;
  
  // UI alaphelyzetbe állítása
  updateSparks();
  resetDice();
  
  // Aktív játékos kijelölése
  updateActivePlayer();
  
  // Kontrollok beállítása
  showControls('roll');
  
  // Üzenet frissítése
  resultEl.textContent = 'A játék kezdetén Loki a kezdő játékos. Dobj a kockákkal!';
  currentClaimEl.textContent = 'Bejelentett érték: Nincs';
  
  // Reset gomb elrejtése
  document.getElementById('resetContainer').style.display = 'none';
}

// Kockák megjelenítésének visszaállítása
function resetDice() {
  playerDice1.innerHTML = '<i class="fas fa-dice-one"></i>';
  playerDice2.innerHTML = '<i class="fas fa-dice-one"></i>';
  botDice1.innerHTML = '<i class="fas fa-dice-one"></i>';
  botDice2.innerHTML = '<i class="fas fa-dice-one"></i>';
  
  playerDice1.classList.remove('dice-roll-1');
  playerDice2.classList.remove('dice-roll-2');
  botDice1.classList.remove('dice-roll-1');
  botDice2.classList.remove('dice-roll-2');
  
  botDice1.classList.add('hidden-dice');
  botDice2.classList.add('hidden-dice');
}

// Szikrák (életpontok) frissítése
function updateSparks() {
  // Játékos szikrák
  playerSparksEl.innerHTML = '';
  for (let i = 0; i < MAX_SPARKS; i++) {
    const sparkEl = document.createElement('i');
    sparkEl.className = 'fas fa-fire spark';
    if (i >= playerSparks) {
      sparkEl.classList.add('lost-spark');
    }
    playerSparksEl.appendChild(sparkEl);
  }
  
  // Bot szikrák
  botSparksEl.innerHTML = '';
  for (let i = 0; i < MAX_SPARKS; i++) {
    const sparkEl = document.createElement('i');
    sparkEl.className = 'fas fa-fire spark';
    if (i >= botSparks) {
      sparkEl.classList.add('lost-spark');
    }
    botSparksEl.appendChild(sparkEl);
  }
}

// Kockadobás
function rollDice() {
  if (!gameActive) return;
  
  // Animáció eltávolítása és újraindítása
  const dice1 = activePlayer === 'player' ? playerDice1 : botDice1;
  const dice2 = activePlayer === 'player' ? playerDice2 : botDice2;
  
  dice1.classList.remove('dice-roll-1');
  dice2.classList.remove('dice-roll-2');
  
  // Bot kockák elrejtése
  if (activePlayer === 'bot') {
    botDice1.classList.remove('hidden-dice');
    botDice2.classList.remove('hidden-dice');
  }
  
  // Kockadobás
  const die1 = Math.floor(Math.random() * 6) + 1;
  const die2 = Math.floor(Math.random() * 6) + 1;
  currentDice = [die1, die2];
  
  // Kockák animálása
  void dice1.offsetWidth; // Trükk az animáció újraindításához
  void dice2.offsetWidth;
  dice1.classList.add('dice-roll-1');
  dice2.classList.add('dice-roll-2');
  
  // Kockák frissítése
  setTimeout(() => {
    dice1.innerHTML = `<i class="fas fa-dice-${getDieFace(die1)}"></i>`;
    dice2.innerHTML = `<i class="fas fa-dice-${getDieFace(die2)}"></i>`;
    
    // Játékos vezérlők frissítése
    if (activePlayer === 'player') {
      updateClaimOptions();
      showControls('claim');
      resultEl.textContent = `Dobtál! Most jelentsd be az értéket (vagy blöffölj)!`;
    } else {
      // Bot döntése
      setTimeout(botDecision, 1500);
    }
  }, 800);
}

// A dobott értékhez megfelelő FontAwesome ikon meghatározása
function getDieFace(value) {
  switch(value) {
    case 1: return 'one';
    case 2: return 'two';
    case 3: return 'three';
    case 4: return 'four';
    case 5: return 'five';
    case 6: return 'six';
    default: return 'one';
  }
}

// Bejelentés lehetőségek frissítése
function updateClaimOptions() {
  // Bejelentés lehetőségek generálása
  claimSelectEl.innerHTML = '';
  
  // A dobott érték meghatározása
  const actualValue = getDiceValue(currentDice[0], currentDice[1]);
  
  if (isNewRound) {
    // Új körben bármit be lehet jelenteni
    valueRanking.forEach(value => {
      const option = document.createElement('option');
      option.value = value;
      option.textContent = valueNames[value];
      claimSelectEl.appendChild(option);
    });
  } else {
    // A korábbi bejelentésnél magasabb értéket kell mondani
    const lastClaimIndex = valueRanking.indexOf(lastClaim);
    for (let i = lastClaimIndex + 1; i < valueRanking.length; i++) {
      const option = document.createElement('option');
      option.value = valueRanking[i];
      option.textContent = valueNames[valueRanking[i]];
      claimSelectEl.appendChild(option);
    }
    
    // Ha nincs magasabb lehetőség, akkor muszáj hazudni
    if (claimSelectEl.options.length === 0) {
      resultEl.textContent = `Nem tudsz magasabb értéket mondani, így kénytelen vagy blöffölni!`;
      const option = document.createElement('option');
      option.value = valueRanking[valueRanking.length - 1]; // Csínytevés (21)
      option.textContent = valueNames[valueRanking[valueRanking.length - 1]];
      claimSelectEl.appendChild(option);
    }
  }
  
  // Alapértelmezett kiválasztás
  if (claimSelectEl.options.length > 0) {
    claimSelectEl.selectedIndex = 0;
  }
}

// Bejelentés
function makeClaim() {
  if (!gameActive) return;
  
  const claimedValue = claimSelectEl.value;
  lastClaim = claimedValue;
  
  // UI frissítése
  currentClaimEl.textContent = `Bejelentett érték: ${valueNames[claimedValue]}`;
  
  if (activePlayer === 'player') {
    resultEl.textContent = `Bejelentetted: ${valueNames[claimedValue]}. A Sötét Nagyúr következik...`;
    switchPlayer();
    setTimeout(() => {
      showControls('roll');
      resultEl.textContent = `A Sötét Nagyúr gondolkodik a következő lépésén...`;
      setTimeout(botRoll, 1500);
    }, 1000);
  } else {
    // Bot bejelentés
    resultEl.textContent = `A Sötét Nagyúr bejelenti: ${valueNames[claimedValue]}. Elhiszed vagy sem?`;
    showControls('response');
  }
}

// Bot kockadobás
function botRoll() {
  rollDice();
}

// Bot döntéshozatal
function botDecision() {
  // Aktuális dobás értéke
  const actualValue = getDiceValue(currentDice[0], currentDice[1]);
  const actualValueIndex = valueRanking.indexOf(actualValue);
  
  // Lehetséges bejelentés értékek a korábbi bejelentéshez képest
  let possibleClaims = [];
  
  if (isNewRound) {
    // Új körben bármit be lehet jelenteni
    possibleClaims = [...valueRanking];
  } else {
    // A korábbi bejelentésnél magasabb értéket kell mondani
    const lastClaimIndex = valueRanking.indexOf(lastClaim);
    for (let i = lastClaimIndex + 1; i < valueRanking.length; i++) {
      possibleClaims.push(valueRanking[i]);
    }
  }
  
  let selectedClaim;
  
  // A bot intelligens stratégiája
  if (possibleClaims.length === 0) {
    // Nincs lehetőség további bejelentésre, muszáj blöffölni
    selectedClaim = valueRanking[valueRanking.length - 1]; // Csínytevés (21)
  } else if (possibleClaims.includes(actualValue) && Math.random() < 0.7) {
    // 70% eséllyel az igazat mondja, ha lehet
    selectedClaim = actualValue;
  } else {
    // Különben stratégikusan blöfföl
    
    // Ha közel van a játék végéhez, óvatosabban blöfföl
    if (botSparks === 1) {
      // Utolsó életénél óvatosabb
      const safeClaimIndex = Math.min(possibleClaims.length - 1, 3);
      selectedClaim = possibleClaims[safeClaimIndex];
    } else if (playerSparks === 1) {
      // Ha a játékos az utolsó életénél van, agresszívebben blöfföl
      const aggressiveIndex = Math.min(possibleClaims.length - 1, possibleClaims.length - 2);
      selectedClaim = possibleClaims[aggressiveIndex];
    } else {
      // Normál esetben az elérhető bejelentések közül választ
      const randomIndex = Math.floor(Math.random() * Math.min(possibleClaims.length, 4));
      selectedClaim = possibleClaims[randomIndex];
    }
  }
  
  lastClaim = selectedClaim;
  currentClaimEl.textContent = `Bejelentett érték: ${valueNames[selectedClaim]}`;
  resultEl.textContent = `A Sötét Nagyúr bejelenti: ${valueNames[selectedClaim]}. Elhiszed vagy sem?`;
  
  // Kontrollok megjelenítése a játékosnak
  showControls('response');
}

// Dobott érték kiszámítása
function getDiceValue(die1, die2) {
  // Csínytevés: 2-1
  if ((die1 === 2 && die2 === 1) || (die1 === 1 && die2 === 2)) {
    return '21';
  }
  
  // Fortély: egyforma számok
  if (die1 === die2) {
    return `f${die1}`;
  }
  
  // Normál érték: a nagyobb szám kerül a tízesek helyére
  if (die1 > die2) {
    return `${die1}${die2}`;
  } else {
    return `${die2}${die1}`;
  }
}

// A játékos elhiszi a bejelentést
function believe() {
  if (!gameActive) return;
  
  resultEl.textContent = `Elhitted a bejelentést. Most te következel!`;
  botDice1.classList.add('hidden-dice');
  botDice2.classList.add('hidden-dice');
  
  isNewRound = false;
  switchPlayer();
  
  setTimeout(() => {
    showControls('roll');
  }, 1000);
}

// A játékos kétségbe vonja a bejelentést
function doubt() {
  if (!gameActive) return;
  
  botDice1.classList.remove('hidden-dice');
  botDice2.classList.remove('hidden-dice');
  
  const actualValue = getDiceValue(currentDice[0], currentDice[1]);
  const claimed = lastClaim;
  
  let didBotLie = (claimed !== actualValue);
  
  if (didBotLie) {
    // A bot hazudott, veszít egy szikrát
    botSparks--;
    resultEl.textContent = `A Sötét Nagyúr hazudott! Valójában ${valueNames[actualValue]} volt a dobása. Veszít egy isteni szikrát!`;
  } else {
    // A bot igazat mondott, a játékos veszít egy szikrát
    playerSparks--;
    resultEl.textContent = `A Sötét Nagyúr igazat mondott! Valóban ${valueNames[actualValue]} volt a dobása. Te veszítesz egy isteni szikrát!`;
  }
  
  // Szikrák frissítése
  updateSparks();
  
  // Játék végének ellenőrzése
  if (checkGameEnd()) return;
  
  // Új kör indítása
  isNewRound = true;
  lastClaim = null;
  
  // Vesztes kezdi a következő kört
  activePlayer = didBotLie ? 'bot' : 'player';
  updateActivePlayer();
  
  setTimeout(() => {
    resetDice();
    currentClaimEl.textContent = 'Bejelentett érték: Nincs';
    
    if (activePlayer === 'player') {
      showControls('roll');
      resultEl.textContent = `Te kezded az új kört. Dobj a kockákkal!`;
    } else {
      resultEl.textContent = `A Sötét Nagyúr kezdi az új kört...`;
      setTimeout(botRoll, 1500);
    }
  }, 2000);
}

// Bot elhiszi vagy nem hiszi el a játékos bejelentését
function botBelieveOrDoubt() {
  const actualValue = getDiceValue(currentDice[0], currentDice[1]);
  const actualValueIndex = valueRanking.indexOf(actualValue);
  const claimedIndex = valueRanking.indexOf(lastClaim);
  
  // Intelligens bot döntési logika
  let botDoubts = false;
  
  // Ha a játékos Csínytevést (21) jelentett be
  if (lastClaim === '21') {
    // 60% eséllyel kétségbe vonja, kivéve ha a játékosnak csak 1 szikrája van
    botDoubts = Math.random() < (playerSparks === 1 ? 0.3 : 0.6);
  }
  // Ha a játékos magas Fortélyt jelentett be
  else if (lastClaim.startsWith('f') && parseInt(lastClaim[1]) >= 4) {
    // 50% eséllyel kétségbe vonja
    botDoubts = Math.random() < 0.5;
  }
  // Ha nagy különbség van a bejelentett és a dobott érték között
  else if (claimedIndex - actualValueIndex > 10) {
    // 70% eséllyel kétségbe vonja
    botDoubts = Math.random() < 0.7;
  }
  // Egyéb esetekben
  else {
    // 30% eséllyel kétségbe vonja
    botDoubts = Math.random() < 0.3;
  }
  
  if (botDoubts) {
    // Bot kétségbe vonja a bejelentést
    const didPlayerLie = (lastClaim !== actualValue);
    
    resultEl.textContent = `A Sötét Nagyúr nem hiszi el a bejelentésed! `;
    
    if (didPlayerLie) {
      // Játékos hazudott, veszít egy szikrát
      playerSparks--;
      resultEl.textContent += `Hazudtál! Valójában ${valueNames[actualValue]} volt a dobásod. Veszítesz egy isteni szikrát!`;
    } else {
      // Játékos igazat mondott, bot veszít egy szikrát
      botSparks--;
      resultEl.textContent += `Igazat mondtál! Valóban ${valueNames[actualValue]} volt a dobásod. A Sötét Nagyúr veszít egy isteni szikrát!`;
    }
    
    // Szikrák frissítése
    updateSparks();
    
    // Játék végének ellenőrzése
    if (checkGameEnd()) return;
    
    // Új kör indítása
    isNewRound = true;
    lastClaim = null;
    
    // Vesztes kezdi a következő kört
    activePlayer = didPlayerLie ? 'player' : 'bot';
    updateActivePlayer();
    
    setTimeout(() => {
      resetDice();
      currentClaimEl.textContent = 'Bejelentett érték: Nincs';
      
      if (activePlayer === 'player') {
        showControls('roll');
        resultEl.textContent = `Te kezded az új kört. Dobj a kockákkal!`;
      } else {
        resultEl.textContent = `A Sötét Nagyúr kezdi az új kört...`;
        setTimeout(botRoll, 1500);
      }
    }, 2000);
  } else {
    // Bot elhiszi a bejelentést
    resultEl.textContent = `A Sötét Nagyúr elhiszi a bejelentésed. Most ő következik.`;
    isNewRound = false;
    switchPlayer();
    
    setTimeout(() => {
      showControls('none');
      botRoll();
    }, 1500);
  }
}

// Játékos váltás
function switchPlayer() {
  activePlayer = activePlayer === 'player' ? 'bot' : 'player';
  updateActivePlayer();
}

// Aktív játékos megjelenítésének frissítése
function updateActivePlayer() {
  if (activePlayer === 'player') {
    playerSectionEl.classList.add('active-player');
    botSectionEl.classList.remove('active-player');
  } else {
    playerSectionEl.classList.remove('active-player');
    botSectionEl.classList.add('active-player');
  }
}

// Játék vége ellenőrzése
function checkGameEnd() {
  if (playerSparks <= 0 || botSparks <= 0) {
    gameActive = false;
    
    if (playerSparks <= 0) {
      resultEl.innerHTML = `<span class="winner">Vereség! A Sötét Nagyúr legyőzött. Minden szikrád elfogyott.</span>`;
    } else {
      resultEl.innerHTML = `<span class="winner">Győzelem! Legyőzted a Sötét Nagyurat. Minden szikrája elfogyott.</span>`;
    }
    
    document.getElementById('resetContainer').style.display = 'block';
    showControls('none');
    return true;
  }
  
  return false;
}

// Vezérlők megjelenítése/elrejtése
function showControls(controlType) {
  rollControlsEl.style.display = controlType === 'roll' ? 'flex' : 'none';
  claimControlsEl.style.display = controlType === 'claim' ? 'flex' : 'none';
  responseControlsEl.style.display = controlType === 'response' ? 'flex' : 'none';
}

// Játék indítása
startGame();
</script>

</body>
</html>
