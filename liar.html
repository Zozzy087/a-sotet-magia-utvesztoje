<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Sötét Mágia Blöff</title>
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: "Eczar", serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      color: #d1c3af;
      margin: 0;
      padding: 20px;
      text-align: center;
      background-color: #0c0c0c;
    }
    h1 {
      font-size: 2.6rem;
      margin-bottom: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      text-shadow: 0 0 10px #ff6400;
      letter-spacing: 2px;
    }
    #gameArea {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      margin: 20px 0;
    }
    .player-section {
      background-color: rgba(20, 14, 10, 0.85);
      padding: 20px;
      border-radius: 5px;
      min-width: 260px;
      border: 1px solid #482c17;
      transition: all 0.3s ease;
      position: relative;
    }
    .active-player {
      border: 3px solid #ff6400;
      box-shadow: 0 0 25px rgba(255, 100, 0, 0.7);
      transform: scale(1.05);
      z-index: 2;
    }
    .active-player::before {
      content: "》";
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    .active-player::after {
      content: "《";
      position: absolute;
      right: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    h2 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #d1c3af;
    }
    .dice-area {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
    }
    .dice {
      width: 50px;
      height: 50px;
      background-color: #291d14;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: #d1c3af;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
    }
    .hidden-dice {
      background-color: #23170f;
      color: #23170f;
      box-shadow: 0 0 10px rgba(139, 0, 0, 0.3) inset;
    }
    .hidden-dice::after {
      content: "?";
      position: absolute;
      color: #6d4e37;
      font-size: 1.5rem;
      opacity: 0.5;
    }
    .dice-roll {
      animation: rollDice 0.8s ease-out;
    }
    @keyframes rollDice {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(720deg) rotateX(360deg); }
      100% { transform: rotateY(1440deg) rotateX(720deg); }
    }
    .controls {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .bet-area {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .current-bet {
      background-color: rgba(72, 44, 23, 0.6);
      padding: 10px;
      border-radius: 5px;
      margin: 15px 0;
      min-width: 280px;
      font-size: 1.2rem;
    }
    .dice-count {
      font-size: 1.1rem;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 5px 10px;
      border-radius: 4px;
      margin-top: 5px;
    }
    button {
      font-family: "Eczar", serif;
      font-size: 1.2rem;
      padding: 12px 25px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #482c17;
      color: #d1c3af;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      transition: all 0.3s;
      letter-spacing: 1px;
    }
    button:hover:not(:disabled) {
      background-color: #5a381f;
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.5);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    select, input {
      font-family: "Eczar", serif;
      font-size: 1.1rem;
      padding: 8px 12px;
      border-radius: 5px;
      border: 1px solid #482c17;
      background-color: #291d14;
      color: #d1c3af;
      margin: 0 5px;
    }
    select:focus, input:focus {
      outline: none;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.5);
    }
    input[type="number"] {
      width: 60px;
      text-align: center;
    }
    #message {
      font-size: 1.3rem;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      margin-top: 20px;
      max-width: 80%;
      letter-spacing: 1px;
      line-height: 1.4;
    }
    #resetContainer {
      display: none;
      margin-top: 30px;
    }
    .winner {
      color: #ff6400;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 100, 0, 0.7);
    }
    .symbol-legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 10px;
      border-radius: 5px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .symbol-item {
      display: flex;
      align-items: center;
      margin: 5px 10px;
    }
    .small-symbol {
      font-size: 1.5rem;
      margin-right: 10px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #291d14;
      border-radius: 5px;
      box-shadow: 0 0 8px rgba(255, 100, 0, 0.2);
    }
    .symbol-text {
      font-size: 1rem;
      text-align: left;
    }
    .reveal-animation {
      animation: reveal 1s forwards;
    }
    @keyframes reveal {
      0% { transform: rotateY(0deg); background-color: #23170f; }
      100% { transform: rotateY(180deg); background-color: #291d14; }
    }
    .reveal-container {
      margin: 20px 0;
      padding: 15px;
      background-color: rgba(20, 14, 10, 0.8);
      border-radius: 5px;
      display: none;
    }
    .history-log {
      margin-top: 20px;
      max-height: 150px;
      overflow-y: auto;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
      text-align: left;
      font-size: 0.9rem;
    }
    .history-log p {
      margin: 5px 0;
      padding: 3px 0;
      border-bottom: 1px solid rgba(255, 100, 0, 0.2);
    }
    .history-log .player-action {
      color: #d1c3af;
    }
    .history-log .bot-action {
      color: #ff6400;
    }
    .history-log .result {
      color: #7fff7f;
    }
  </style>
</head>
<body>

<h1>Sötét Mágia Blöff</h1>

<div class="symbol-legend">
  <div class="symbol-item">
    <div class="small-symbol">&#x2620;</div>
    <div class="symbol-text">Halál</div>
  </div>
  <div class="symbol-item">
    <div class="small-symbol">&#x1F577;</div>
    <div class="symbol-text">Pók</div>
  </div>
  <div class="symbol-item">
    <div class="small-symbol">&#x1F426;</div>
    <div class="symbol-text">Holló</div>
  </div>
  <div class="symbol-item">
    <div class="small-symbol">&#x1F5E1;</div>
    <div class="symbol-text">Kard</div>
  </div>
  <div class="symbol-item">
    <div class="small-symbol">&#x1F525;</div>
    <div class="symbol-text">Tűz</div>
  </div>
  <div class="symbol-item">
    <div class="small-symbol">&#x1F479;</div>
    <div class="symbol-text">Démon</div>
  </div>
</div>

<div id="gameArea">
  <div id="playerSection" class="player-section active-player">
    <h2>Kalandor</h2>
    <div class="dice-count">Mágikus kövek: <span id="playerDiceCount">5</span></div>
    <div id="playerDice" class="dice-area"></div>
  </div>
  
  <div id="botSection" class="player-section">
    <h2>Sötét Nagyúr</h2>
    <div class="dice-count">Mágikus kövek: <span id="botDiceCount">5</span></div>
    <div id="botDice" class="dice-area"></div>
  </div>
</div>

<div class="current-bet" id="currentBet">
  A jelenlegi tét: Még nincs
</div>

<div id="revealContainer" class="reveal-container">
  <h3>A kockák felfedése</h3>
  <div id="revealDice" class="dice-area"></div>
  <div id="revealResult"></div>
</div>

<div class="controls" id="controls">
  <div class="bet-area">
    <label>Mágikus szimbólum: 
      <select id="betValue">
        <option value="1">&#x2620; Halál</option>
        <option value="2">&#x1F577; Pók</option>
        <option value="3">&#x1F426; Holló</option>
        <option value="4">&#x1F5E1; Kard</option>
        <option value="5">&#x1F525; Tűz</option>
        <option value="6">&#x1F479; Démon</option>
      </select>
    </label>
    <label>Mennyiség: 
      <input type="number" id="betCount" min="1" value="1">
    </label>
  </div>
  <div>
    <button id="betButton" onclick="placeBet()">Tét Megtétele</button>
    <button id="callButton" onclick="callBluff()">Leleplezés!</button>
  </div>
</div>

<div id="message">Lépj a mágikus kövek ősi játékterébe! A Sötét Nagyúr árgus szemekkel figyel...</div>

<div id="resetContainer">
  <button onclick="startGame()">Új Játék</button>
</div>

<div class="history-log" id="historyLog">
  <p>A mágikus játszma kezdetét veszi...</p>
</div>

<script>
// Játék állapot változók
let playerDice = []; // A játékos kockái
let botDice = [];    // A bot kockái
let playerDiceCount = 5;
let botDiceCount = 5;
let currentBet = null; // {count: 3, value: 4} - pl. 3 db 4-es
let gameActive = true;
let isPlayerTurn = true;
let gameHistory = [];
let botBluffLikelihood = 0.3; // A bot blöffölési hajlama
let botCautionLevel = 0.5;   // A bot óvatossági szintje
let totalRounds = 0;

// Szimbólumok és értékek
const symbols = [
  { value: 1, symbol: '&#x2620;', name: 'Halál' },
  { value: 2, symbol: '&#x1F577;', name: 'Pók' },
  { value: 3, symbol: '&#x1F426;', name: 'Holló' },
  { value: 4, symbol: '&#x1F5E1;', name: 'Kard' },
  { value: 5, symbol: '&#x1F525;', name: 'Tűz' },
  { value: 6, symbol: '&#x1F479;', name: 'Démon' }
];

// DOM elemek
const playerDiceEl = document.getElementById('playerDice');
const botDiceEl = document.getElementById('botDice');
const playerDiceCountEl = document.getElementById('playerDiceCount');
const botDiceCountEl = document.getElementById('botDiceCount');
const currentBetEl = document.getElementById('currentBet');
const messageEl = document.getElementById('message');
const playerSectionEl = document.getElementById('playerSection');
const botSectionEl = document.getElementById('botSection');
const historyLogEl = document.getElementById('historyLog');
const revealContainerEl = document.getElementById('revealContainer');
const revealDiceEl = document.getElementById('revealDice');
const revealResultEl = document.getElementById('revealResult');

// Játék indítása
function startGame() {
  playerDiceCount = 5;
  botDiceCount = 5;
  currentBet = null;
  gameActive = true;
  isPlayerTurn = true;
  gameHistory = [];
  totalRounds = 0;
  
  // Bot alap stratégia beállítása
  botBluffLikelihood = 0.3;
  botCautionLevel = 0.5;
  
  // Kockák generálása
  rollDice();
  
  // UI frissítése
  playerDiceCountEl.textContent = playerDiceCount;
  botDiceCountEl.textContent = botDiceCount;
  currentBetEl.textContent = "A jelenlegi tét: Még nincs";
  messageEl.textContent = "Lépj a mágikus kövek ősi játékterébe! A te lépésed következik.";
  historyLogEl.innerHTML = "<p>A mágikus játszma kezdetét veszi...</p>";
  
  // Gombok beállítása
  document.getElementById('betButton').disabled = false;
  document.getElementById('callButton').disabled = true;
  document.getElementById('resetContainer').style.display = 'none';
  revealContainerEl.style.display = 'none';
  
  // Játékos aktiválása
  playerSectionEl.classList.add('active-player');
  botSectionEl.classList.remove('active-player');
  
  // Input mezők alapértékei
  document.getElementById('betValue').value = "1";
  document.getElementById('betCount').value = "1";
  
  // Minimum tét beállítása
  document.getElementById('betCount').min = "1";
}

// Kockák újradobása
function rollDice() {
  playerDice = generateRandomDice(playerDiceCount);
  botDice = generateRandomDice(botDiceCount);
  
  renderDice();
}

// Véletlen kockák generálása
function generateRandomDice(count) {
  const dice = [];
  for (let i = 0; i < count; i++) {
    dice.push(Math.floor(Math.random() * 6) + 1); // 1-6 közötti érték
  }
  return dice;
}

// Kockák megjelenítése
function renderDice() {
  // Játékos kockái
  playerDiceEl.innerHTML = '';
  playerDice.forEach(die => {
    const symbol = symbols.find(s => s.value === die);
    const diceElement = document.createElement('div');
    diceElement.className = 'dice dice-roll';
    diceElement.innerHTML = symbol.symbol;
    
    // Kis késleltetés az animációhoz
    setTimeout(() => {
      diceElement.classList.remove('dice-roll');
    }, 800);
    
    playerDiceEl.appendChild(diceElement);
  });
  
  // Bot kockái (rejtve)
  botDiceEl.innerHTML = '';
  botDice.forEach(() => {
    const diceElement = document.createElement('div');
    diceElement.className = 'dice hidden-dice';
    botDiceEl.appendChild(diceElement);
  });
}

// Tét megtétele
function placeBet() {
  if (!gameActive || !isPlayerTurn) return;
  
  const betValue = parseInt(document.getElementById('betValue').value);
  const betCount = parseInt(document.getElementById('betCount').value);
  
  // Ellenőrizze, hogy a tét ésszerű-e
  const totalDice = playerDiceCount + botDiceCount;
  if (betCount > totalDice) {
    showMessage(`Túl magas tétet mondtál! Maximum ${totalDice} mágikus kő van jelenleg játékban.`);
    return;
  }
  
  // Ellenőrizzük a tét érvényességét
  if (currentBet !== null) {
    if (betCount < currentBet.count || (betCount === currentBet.count && betValue <= currentBet.value)) {
      showMessage("A tétnek magasabbnak kell lennie! Vagy több mágikus szimbólumot kell mondanod, vagy ugyanannyi magasabb szimbólumot.");
      return;
    }
  }
  
  // Tét beállítása
  currentBet = { count: betCount, value: betValue };
  
  // UI frissítése
  const symbolObj = symbols.find(s => s.value === betValue);
  currentBetEl.textContent = `A jelenlegi tét: ${betCount} db ${symbolObj.symbol} (${symbolObj.name})`;
  
  // Játékos körének befejezése
  endPlayerTurn();
  
  // Esemény rögzítése
  logEvent(`Kalandor: "${betCount} ${symbolObj.name} szimbólum van a játékban."`, 'player-action');
  
  // Bot köre
  setTimeout(botTurn, 1500);
}

// Bot köre
function botTurn() {
  if (!gameActive) return;
  
  playerSectionEl.classList.remove('active-player');
  botSectionEl.classList.add('active-player');
  
  showMessage("A Sötét Nagyúr fontolgatja a lépését...");
  
  // Bot stratégiájának beállítása a játék állása alapján
  updateBotStrategy();
  
  // Bot intelligens döntéshozatala
  setTimeout(() => {
    // Bot gondolkodása
    const botAction = decideBotAction();
    
    if (botAction.action === 'call') {
      // Bot blöfföt kiált
      showMessage("A Sötét Nagyúr megérezte varázslatodban a gyengeséget! Leleplezi blöffödet!");
      logEvent(`Sötét Nagyúr: "Leleplezlek, halandó! Nem lehet ennyi ${symbols.find(s => s.value === currentBet.value).name} a játéktéren!"`, 'bot-action');
      
      setTimeout(revealDice, 1500);
    } else {
      // Bot emeli a tétet
      currentBet = botAction.bet;
      const symbolObj = symbols.find(s => s.value === currentBet.value);
      
      showMessage(`A Sötét Nagyúr emeli a tétet: ${currentBet.count} db ${symbolObj.name} szimbólum!`);
      currentBetEl.textContent = `A jelenlegi tét: ${currentBet.count} db ${symbolObj.symbol} (${symbolObj.name})`;
      
      logEvent(`Sötét Nagyúr: "${currentBet.count} ${symbolObj.name} szimbólum van a játékban."`, 'bot-action');
      
      // Input mezők frissítése
      document.getElementById('betValue').value = "1";
      document.getElementById('betCount').value = (currentBet.count + 1).toString();
      document.getElementById('betCount').min = (currentBet.count + 1).toString();
      
      // Vissza a játékoshoz
      setTimeout(startPlayerTurn, 1500);
    }
  }, 2000);
}

// Bot stratégiájának frissítése a játék állása alapján
function updateBotStrategy() {
  totalRounds++;
  
  // A játék előrehaladtával a bot figyel a játékos stílusára
  if (gameHistory.length > 3) {
    // Játékos blöffölési hajlama
    const playerBluffRate = calculatePlayerBluffRate();
    
    // Ha a játékos gyakran blöfföl
    if (playerBluffRate > 0.6) {
      botCautionLevel = Math.min(0.8, botCautionLevel + 0.1); // Óvatosabb lesz
    } 
    // Ha a játékos ritkán blöfföl
    else if (playerBluffRate < 0.3) {
      botCautionLevel = Math.max(0.2, botCautionLevel - 0.1); // Merészebb lesz
      botBluffLikelihood = Math.min(0.7, botBluffLikelihood + 0.1); // Többet blöfföl
    }
  }
  
  // Ha a bot hátrányban van
  if (botDiceCount < playerDiceCount) {
    botBluffLikelihood = Math.min(0.7, botBluffLikelihood + 0.1); // Növelt blöffölés
    botCautionLevel = Math.max(0.3, botCautionLevel - 0.1);       // Kisebb óvatosság
  }
  
  // Ha a bot előnyben van
  if (botDiceCount > playerDiceCount) {
    botBluffLikelihood = Math.max(0.2, botBluffLikelihood - 0.05); // Kevesebb blöff
    botCautionLevel = Math.min(0.7, botCautionLevel + 0.1);        // Nagyobb óvatosság
  }
  
  // Játék vége felé (ha már csak kevés kő van)
  if (botDiceCount <= 2 || playerDiceCount <= 2) {
    // A bot kockáztatóbb lesz
    botBluffLikelihood = Math.min(0.8, botBluffLikelihood + 0.2);
    botCautionLevel = Math.max(0.2, botCautionLevel - 0.2);
  }
}

// Játékos blöffölési arányának kiszámítása
function calculatePlayerBluffRate() {
  const relevantHistory = gameHistory.filter(entry => 
    entry.type === 'result' && entry.message.includes('Kalandor blöffölt')
  );
  
  if (totalRounds === 0) return 0.5; // Alapértelmezett
  return relevantHistory.length / totalRounds;
}

// Bot döntéshozatala
function decideBotAction() {
  // 1. Számoljuk meg a bot kockáin a jelenlegi tét értékét
  const botDiceWithValue = botDice.filter(die => die === currentBet.value);
  
  // 2. Becsüljük meg a játékos kockáin lévő értékeket
  // (valószínűség alapján, feltételezve egyenletes eloszlást)
  const expectedPlayerDiceWithValue = playerDiceCount / 6;
  
  // 3. Becsült teljes mennyiség
  const estimatedTotal = botDiceWithValue.length + expectedPlayerDiceWithValue;
  
  // 4. A teljes kockák száma
  const totalDice = playerDiceCount + botDiceCount;
  
  // 5. Annak a valószínűsége, hogy a játékos tétet igaz
  const probabilityOfTruth = estimatedTotal / currentBet.count;
  
  // 6. Bot blöff leleplezési stratégiája
  
  // Ha a tét irreálisan magas
  if (currentBet.count > totalDice * 0.7) {
    const callChance = 0.9 - (botCautionLevel * 0.3);
    if (Math.random() < callChance) {
      return { action: 'call' };
    }
  }
  
  // Ha nagyon alacsony a valószínűsége a tét igazságának
  if (probabilityOfTruth < 0.5 - (botCautionLevel * 0.2)) {
    // Valószínűleg a játékos blöfföl
    return { action: 'call' };
  }
  
  // Ha közepes a valószínűség
  if (probabilityOfTruth < 0.7) {
    // A bot óvatossági szintje befolyásolja a döntést
    if (Math.random() > botCautionLevel) {
      return { action: 'call' };
    }
  }
  
  // 7. Bot tét emelési stratégiája
  return createBotBet(estimatedTotal);
}

// Bot tét létrehozása
function createBotBet(estimatedTotal) {
  // Bot intelligens tétstratégiája
  
  // 1. A bot kockáinak elemzése
  const valueCounts = {};
  for (let i = 1; i <= 6; i++) {
    valueCounts[i] = botDice.filter(die => die === i).length;
  }
  
  // 2. A bot legjobb kockái (melyek értékből van a legtöbb)
  let bestValue = 1;
  let bestCount = valueCounts[1];
  
  for (let i = 2; i <= 6; i++) {
    if (valueCounts[i] > bestCount) {
      bestValue = i;
      bestCount = valueCounts[i];
    }
  }
  
  // 3. A bot blöffölne vagy valós tétet tenne?
  const willBluff = Math.random() < botBluffLikelihood;
  
  let newBet;
  
  // Alapértelmezett minimális emelés
  let minRaise = { 
    count: currentBet.count,
    value: currentBet.value < 6 ? currentBet.value + 1 : 1 // Ha 6-os, akkor 1-re vált
  };
  
  if (minRaise.value === 1 && minRaise.count === currentBet.count) {
    minRaise.count++; // Ha 1-es értékre vált, a darabszámot növeli
  }
  
  // 4. Blöffölés - magasabb tétet tesz, mint ami valószínű
  if (willBluff) {
    // A blöff mértéke függ a játék helyzetétől
    let bluffFactor = 1;
    
    if (botDiceCount <= 2) bluffFactor = 2; // Kétségbeesett helyzetben nagyobbat blöfföl
    if (botDiceCount > playerDiceCount + 1) bluffFactor = 1; // Előnyben kisebbet
    
    // Blöff tétstratégia
    if (Math.random() < 0.6) {
      // Darabszám emelés (csak kicsit a valószínű fölé)
      newBet = {
        count: Math.floor(estimatedTotal) + bluffFactor,
        value: bestValue // Kedvező érték választása
      };
    } else {
      // Minimális emelés (biztonságos)
      newBet = minRaise;
    }
    
    // Ellenőrizzük, hogy a blöff ne legyen túl nyilvánvaló
    const totalDice = playerDiceCount + botDiceCount;
    if (newBet.count > totalDice * 0.8) {
      // Túl magas, korrigáljuk
      newBet.count = Math.floor(totalDice * 0.7);
    }
  } 
  // 5. Valós tét - a bot által ismert értékek alapján
  else {
    // Ha sok egyforma kockája van, azon az értéken emel
    if (bestCount >= 2) {
      newBet = {
        count: currentBet.count + 1,
        value: bestValue
      };
    } 
    // Különben minimális emelés
    else {
      newBet = minRaise;
    }
  }
  
  // 6. Ellenőrizzük, hogy a tét érvényes-e
  // Összehasonlítjuk a jelenlegi téttel
  if (newBet.count < currentBet.count || 
      (newBet.count === currentBet.count && newBet.value <= currentBet.value)) {
    // Érvénytelen tét, korrigáljuk
    if (currentBet.value < 6) {
      newBet = {
        count: currentBet.count,
        value: currentBet.value + 1
      };
    } else {
      newBet = {
        count: currentBet.count + 1,
        value: 1
      };
    }
  }
  
  return { action: 'bet', bet: newBet };
}

// Játékos körének kezdése
function startPlayerTurn() {
  isPlayerTurn = true;
  playerSectionEl.classList.add('active-player');
  botSectionEl.classList.remove('active-player');
  
  showMessage("A te lépésed! Folytasd a tétet vagy leplezd le a Sötét Nagyurat!");
  
  // Gombok aktiválása
  document.getElementById('betButton').disabled = false;
  document.getElementById('callButton').disabled = false;
}

// Játékos körének befejezése
function endPlayerTurn() {
  isPlayerTurn = false;
  document.getElementById('betButton').disabled = true;
  document.getElementById('callButton').disabled = true;
}

// Blöff leleplezése
function callBluff() {
  if (!gameActive || !isPlayerTurn || currentBet === null) return;
  
  endPlayerTurn();
  
  showMessage("Leleplezed a Sötét Nagyúr állítását! Felfedésre kerülnek a mágikus kövek...");
  logEvent(`Kalandor: "Leleplezlek, Sötét Nagyúr! Nem lehet ennyi ${symbols.find(s => s.value === currentBet.value).name} a játéktéren!"`, 'player-action');
  
  setTimeout(revealDice, 1500);
}

// Kockák felfedése
function revealDice() {
  revealContainerEl.style.display = 'block';
  revealDiceEl.innerHTML = '';
  
  // Minden kocka összegyűjtése
  const allDice = [...playerDice, ...botDice];
  
  // Számoljuk meg a keresett értékeket
  const targetSymbol = symbols.find(s => s.value === currentBet.value);
  const targetCount = allDice.filter(die => die === currentBet.value).length;
  
  // A kockák megjelenítése egymás után, animációval
  allDice.forEach((die, index) => {
    const symbol = symbols.find(s => s.value === die);
    const diceElement = document.createElement('div');
    diceElement.className = 'dice hidden-dice';
    
    // Késleltetett felfedés
    setTimeout(() => {
      diceElement.classList.add('reveal-animation');
      
      // Felfedés animáció végén
      setTimeout(() => {
        diceElement.classList.remove('hidden-dice', 'reveal-animation');
        diceElement.innerHTML = symbol.symbol;
        
        // Ha ez az utolsó kocka, megmutatjuk az eredményt
        if (index === allDice.length - 1) {
          setTimeout(() => {
            showRevealResult(targetSymbol, targetCount);
          }, 500);
        }
      }, 500);
    }, index * 300);
    
    revealDiceEl.appendChild(diceElement);
  });
}

// Leleplezés eredményének megjelenítése
function showRevealResult(targetSymbol, actualCount) {
  // Ellenőrizzük az állítás helyességét
  const claim = currentBet.count;
  const isBluff = actualCount < claim;
  
  let resultHtml = '';
  let loser = '';
  
  if (isPlayerTurn) { // A játékos leplezte le a botot
    if (isBluff) {
      // A bot blöffölt, a játékos nyert
      resultHtml = `<p class="winner">A leleplezés sikeres! A játéktéren csak ${actualCount} db ${targetSymbol.symbol} (${targetSymbol.name}) van, nem ${claim}.</p>`;
      loser = 'bot';
      logEvent(`Eredmény: A Sötét Nagyúr blöffölt! Csak ${actualCount} db ${targetSymbol.name} volt a játéktéren.`, 'result');
    } else {
      // A bot nem blöffölt, a játékos veszített
      resultHtml = `<p class="winner">A leleplezés sikertelen! A játéktéren valóban ${actualCount} db ${targetSymbol.symbol} (${targetSymbol.name}) van!</p>`;
      loser = 'player';
      logEvent(`Eredmény: A Sötét Nagyúr igazat mondott! Valóban ${actualCount} db ${targetSymbol.name} volt a játéktéren.`, 'result');
    }
  } else { // A bot leplezte le a játékost
    if (isBluff) {
      // A játékos blöffölt, a bot nyert
      resultHtml = `<p class="winner">A Sötét Nagyúr sikeresen leleplezte blöffödet! A játéktéren csak ${actualCount} db ${targetSymbol.symbol} (${targetSymbol.name}) van, nem ${claim}.</p>`;
      loser = 'player';
      logEvent(`Eredmény: A Kalandor blöffölt! Csak ${actualCount} db ${targetSymbol.name} volt a játéktéren.`, 'result');
    } else {
      // A játékos nem blöffölt, a bot veszített
      resultHtml = `<p class="winner">A Sötét Nagyúr tévedett! A játéktéren valóban ${actualCount} db ${targetSymbol.symbol} (${targetSymbol.name}) van!</p>`;
      loser = 'bot';
      logEvent(`Eredmény: A Kalandor igazat mondott! Valóban ${actualCount} db ${targetSymbol.name} volt a játéktéren.`, 'result');
    }
  }
  
  revealResultEl.innerHTML = resultHtml;
  
  // Következő kör előkészítése
  setTimeout(() => {
    nextRound(loser);
  }, 2500);
}

// Következő kör
function nextRound(loser) {
  // Kontéter elrejtése
  revealContainerEl.style.display = 'none';
  
  // A vesztes veszít egy kockát
  if (loser === 'player') {
    playerDiceCount--;
    playerDiceCountEl.textContent = playerDiceCount;
    showMessage("Elvesztettél egy mágikus követ! A Sötét Nagyúr kegyetlenül nevet...");
    isPlayerTurn = false;
  } else { // 'bot'
    botDiceCount--;
    botDiceCountEl.textContent = botDiceCount;
    showMessage("A Sötét Nagyúr elvesztett egy mágikus követ! Dühösen mordul fel...");
    isPlayerTurn = true;
  }
  
  // Ellenőrizzük, hogy véget ért-e a játék
  if (playerDiceCount === 0) {
    gameEnd('bot');
    return;
  } else if (botDiceCount === 0) {
    gameEnd('player');
    return;
  }
  
  // Új kör indítása
  currentBet = null;
  currentBetEl.textContent = "A jelenlegi tét: Még nincs";
  
  // Új kockák dobása
  rollDice();
  
  // Input mezők alapértékei
  document.getElementById('betValue').value = "1";
  document.getElementById('betCount').value = "1";
  document.getElementById('betCount').min = "1";
  
  // A vesztes kezdi a következő kört
  if (loser === 'player') {
    playerSectionEl.classList.remove('active-player');
    botSectionEl.classList.add('active-player');
    
    // Bot indít
    setTimeout(botTurn, 2000);
  } else {
    // Játékos indít
    playerSectionEl.classList.add('active-player');
    botSectionEl.classList.remove('active-player');
    
    // Gombok aktiválása
    document.getElementById('betButton').disabled = false;
    document.getElementById('callButton').disabled = true; // Első körben nincs mit leleplezni
    
    showMessage("Új kör kezdődik! Te következel.");
  }
}

// Játék vége
function gameEnd(winner) {
  gameActive = false;
  
  if (winner === 'player') {
    showMessage("GYŐZELEM! Legyőzted a Sötét Nagyurat! A birodalom megszabadul átkától.");
    logEvent("A Kalandor győzedelmeskedett a Sötét Nagyúr felett!", 'result');
  } else {
    showMessage("VERESÉG! A Sötét Nagyúr elpusztította az utolsó mágikus kövedet is. A birodalom elveszett.");
    logEvent("A Sötét Nagyúr győzedelmeskedett a Kalandor felett!", 'result');
  }
  
  // Új játék gomb megjelenítése
  document.getElementById('resetContainer').style.display = 'block';
  
  // Gombok letiltása
  document.getElementById('betButton').disabled = true;
  document.getElementById('callButton').disabled = true;
}

// Üzenet megjelenítése
function showMessage(message) {
  messageEl.textContent = message;
}

// Esemény rögzítése
function logEvent(message, className) {
  const logEntry = document.createElement('p');
  logEntry.textContent = message;
  if (className) logEntry.className = className;
  historyLogEl.appendChild(logEntry);
  
  // Görgessünk az aljára
  historyLogEl.scrollTop = historyLogEl.scrollHeight;
  
  // Események rögzítése a játéktörténetben
  gameHistory.push({ message, type: className });
}

// Játék indítása
startGame();
</script>

</body>
</html>
