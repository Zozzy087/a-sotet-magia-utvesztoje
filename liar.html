<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Mia - Sötét Kockajáték</title>
  <link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: "Eczar", serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      color: #d1c3af;
      margin: 0;
      padding: 20px;
      text-align: center;
      background-color: #0c0c0c;
    }
    h1 {
      font-size: 2.6rem;
      margin-bottom: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      text-shadow: 0 0 10px #ff6400;
      letter-spacing: 2px;
    }
    #gameArea {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      margin: 20px 0;
    }
    .player-section {
      background-color: rgba(20, 14, 10, 0.85);
      padding: 20px;
      border-radius: 5px;
      min-width: 260px;
      border: 1px solid #482c17;
      transition: all 0.3s ease;
      position: relative;
    }
    .active-player {
      border: 3px solid #ff6400;
      box-shadow: 0 0 25px rgba(255, 100, 0, 0.7);
      transform: scale(1.05);
      z-index: 2;
    }
    .active-player::before {
      content: "》";
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    .active-player::after {
      content: "《";
      position: absolute;
      right: -30px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      color: #ff6400;
      text-shadow: 0 0 10px #ff6400;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    h2 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #d1c3af;
    }
    .dice-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      position: relative;
    }
    .dice {
      position: relative;
      width: 70px;
      height: 70px;
      font-size: 2.2rem;
      background-color: #291d14;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }
    .dice-cover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #482c17;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .dice-cover:hover {
      background-color: #5a381f;
    }
    .dice-roll {
      animation: rollDice 0.8s ease-out;
    }
    @keyframes rollDice {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      50% { transform: rotateY(720deg) rotateX(360deg); }
      100% { transform: rotateY(0deg) rotateX(0deg); }
    }
    .lives {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 15px 0;
      font-size: 1.5rem;
    }
    .life {
      color: #ff6400;
      text-shadow: 0 0 5px #ff6400;
    }
    .life-lost {
      color: #482c17;
      text-shadow: none;
    }
    .claim {
      background-color: rgba(72, 44, 23, 0.6);
      padding: 10px;
      border-radius: 5px;
      margin: 15px auto;
      width: 80%;
      font-size: 1.2rem;
    }
    #controls {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    #claim-controls, #response-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    button {
      font-family: "Eczar", serif;
      font-size: 1.1rem;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #482c17;
      color: #d1c3af;
      box-shadow: 0 0 10px rgba(255, 100, 0, 0.3);
      transition: all 0.3s;
      letter-spacing: 1px;
    }
    button:hover:not(:disabled) {
      background-color: #5a381f;
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 100, 0, 0.5);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .value-button {
      min-width: 60px;
    }
    #announcement {
      font-size: 1.3rem;
      background-color: rgba(20, 14, 10, 0.7);
      padding: 15px;
      border-radius: 5px;
      display: inline-block;
      margin: 20px auto;
      max-width: 80%;
      letter-spacing: 1px;
      line-height: 1.4;
    }
    #game-log {
      font-size: 1rem;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      margin: 20px auto;
      max-width: 80%;
      height: 200px;
      overflow-y: auto;
      text-align: left;
      line-height: 1.4;
    }
    .log-entry {
      margin-bottom: 5px;
      padding-bottom: 5px;
      border-bottom: 1px solid #482c17;
    }
    .player-log {
      color: #d1c3af;
    }
    .opponent-log {
      color: #ff6400;
    }
    .system-log {
      color: #8a8a8a;
      font-style: italic;
    }
    .challenge-log {
      color: #ff9d5c;
      font-weight: bold;
    }
    .winner {
      color: #ff6400;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 100, 0, 0.7);
    }
    #resetContainer {
      display: none;
      margin-top: 30px;
    }
    .rule-toggle {
      background-color: #291d14;
      color: #d1c3af;
      padding: 10px;
      border-radius: 5px;
      margin: 20px auto;
      max-width: 80%;
      cursor: pointer;
      border: 1px solid #482c17;
    }
    #rules {
      display: none;
      background-color: rgba(20, 14, 10, 0.85);
      padding: 15px;
      border-radius: 5px;
      margin: 10px auto;
      max-width: 80%;
      text-align: left;
      line-height: 1.5;
    }
  </style>
</head>
<body>

<h1>Mia - A Sötét Kockajáték</h1>

<div class="rule-toggle" onclick="toggleRules()">Játékszabályok mutatása/elrejtése</div>
<div id="rules">
  <h3>Játékszabályok:</h3>
  <p>A Mia (más néven Mexikói) egy blöffölős kockajáték.</p>
  <p><strong>Kezdés:</strong> Minden játékos 6 élettel indul.</p>
  <p><strong>Kör menete:</strong></p>
  <ol>
    <li>A soron következő játékos dob a kockákkal és megnézi az eredményt.</li>
    <li>Ezután bejelent egy értéket, ami lehet az igazság vagy blöff.</li>
    <li>A következő játékos vagy elfogadja ezt (és magasabb/azonos értéket jelent be), vagy kihívja (ellenőrzi a dobást).</li>
    <li>Ha a kihívás sikeres (a másik játékos blöffölt), akkor a blöffölő veszít egy életet.</li>
    <li>Ha a kihívás sikertelen, akkor a kihívó veszít egy életet.</li>
  </ol>
  <p><strong>Értékek sorrendje (növekvő):</strong></p>
  <ul>
    <li>31 (legalacsonyabb)</li>
    <li>32, 41, 42, 43, 51, 52, 53, 54, 61, 62, 63, 64, 65</li>
    <li>Párok: 11, 22, 33, 44, 55, 66</li>
    <li>21 (Mia) - a legmagasabb érték</li>
  </ul>
  <p>A játék célja: Maradj életben, miközben ellenfeled blöffjeit leplezed le.</p>
</div>

<div id="gameArea">
  <div id="playerSection" class="player-section active-player">
    <h2>Kalandor</h2>
    <div class="lives" id="playerLives">
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
    </div>
    <div class="claim" id="playerClaim">Még nincs bejelentés</div>
    <div class="dice-container" id="playerDice">
      <div class="dice">
        <i class="fas fa-dice-one"></i>
        <div class="dice-cover" id="playerDiceCover1"><i class="fas fa-question"></i></div>
      </div>
      <div class="dice">
        <i class="fas fa-dice-one"></i>
        <div class="dice-cover" id="playerDiceCover2"><i class="fas fa-question"></i></div>
      </div>
    </div>
  </div>
  
  <div id="opponentSection" class="player-section">
    <h2>Sötét Nagyúr</h2>
    <div class="lives" id="opponentLives">
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
      <i class="fas fa-heart life"></i>
    </div>
    <div class="claim" id="opponentClaim">Még nincs bejelentés</div>
    <div class="dice-container" id="opponentDice">
      <div class="dice">
        <i class="fas fa-dice-one"></i>
        <div class="dice-cover" id="opponentDiceCover1"><i class="fas fa-question"></i></div>
      </div>
      <div class="dice">
        <i class="fas fa-dice-one"></i>
        <div class="dice-cover" id="opponentDiceCover2"><i class="fas fa-question"></i></div>
      </div>
    </div>
  </div>
</div>

<div id="announcement">Dobáshoz kattints a "Dobás" gombra. Kezdj egy új kört!</div>

<div id="controls">
  <div id="claim-controls">
    <button id="rollButton" onclick="rollDice()">Dobás</button>
    
    <div id="valueButtons" style="display: none;">
      <button class="value-button" onclick="makePlayerClaim('31')">31</button>
      <button class="value-button" onclick="makePlayerClaim('32')">32</button>
      <button class="value-button" onclick="makePlayerClaim('41')">41</button>
      <button class="value-button" onclick="makePlayerClaim('42')">42</button>
      <button class="value-button" onclick="makePlayerClaim('43')">43</button>
      <button class="value-button" onclick="makePlayerClaim('51')">51</button>
      <button class="value-button" onclick="makePlayerClaim('52')">52</button>
      <button class="value-button" onclick="makePlayerClaim('53')">53</button>
      <button class="value-button" onclick="makePlayerClaim('54')">54</button>
      <button class="value-button" onclick="makePlayerClaim('61')">61</button>
      <button class="value-button" onclick="makePlayerClaim('62')">62</button>
      <button class="value-button" onclick="makePlayerClaim('63')">63</button>
      <button class="value-button" onclick="makePlayerClaim('64')">64</button>
      <button class="value-button" onclick="makePlayerClaim('65')">65</button>
      <button class="value-button" onclick="makePlayerClaim('11')">11</button>
      <button class="value-button" onclick="makePlayerClaim('22')">22</button>
      <button class="value-button" onclick="makePlayerClaim('33')">33</button>
      <button class="value-button" onclick="makePlayerClaim('44')">44</button>
      <button class="value-button" onclick="makePlayerClaim('55')">55</button>
      <button class="value-button" onclick="makePlayerClaim('66')">66</button>
      <button class="value-button" onclick="makePlayerClaim('21')">21 (Mia)</button>
    </div>
  </div>
  
  <div id="response-controls" style="display: none;">
    <button id="acceptButton" onclick="acceptClaim()">Elfogadom</button>
    <button id="challengeButton" onclick="challengeClaim()">Kihívás!</button>
  </div>
</div>

<div id="game-log">
  <div class="log-entry system-log">A játék elkezdődött. Jó szerencsét!</div>
</div>

<div id="resetContainer">
  <button onclick="startGame()">Új Játék</button>
</div>

<script>
//-------------------------
// JÁTÉK ÁLLAPOT VÁLTOZÓK
//-------------------------
let playerLives = 6;
let opponentLives = 6;
let playerDice = [1, 1];
let opponentDice = [1, 1];
let gameActive = true;
let currentTurn = 'player'; // 'player' vagy 'opponent'
let lastClaim = null; // Az utolsó bejelentett érték
let diceValues = null; // Az aktuális kockadobás értékei 
let playerBluffHistory = []; // A játékos blöffölési előzményeinek nyomon követése
let opponentBluffHistory = []; // Az ellenfél blöffölési előzményeinek nyomon követése
let roundCount = 0; // Körök száma
let firstRoll = true; // Ez-e az első dobás a játékban

//-------------------------
// JÁTÉK LOGIKA SEGÉDFÜGGVÉNYEK
//-------------------------

// Kockadobás megvalósítása
function rollDiceValues() {
  return [Math.floor(Math.random() * 6) + 1, Math.floor(Math.random() * 6) + 1];
}

// Kockaérték string formátumú reprezentációja (pl. "42", "21" (Mia))
function formatDiceValue(dice) {
  // Érték növekvő sorrendbe rendezése, kivéve a "21" (Mia) speciális eset
  if ((dice[0] === 2 && dice[1] === 1) || (dice[0] === 1 && dice[1] === 2)) {
    return "21"; // Mia - a legmagasabb érték
  }
  
  // A nagyobb értéket előre tesszük (kivéve Mia esetén)
  return Math.max(dice[0], dice[1]).toString() + Math.min(dice[0], dice[1]).toString();
}

// Kockadobás megjelenítése a megfelelő Font Awesome ikonokkal
function showDiceValue(diceElement, value) {
  const icons = [
    'fas fa-dice-one',
    'fas fa-dice-two',
    'fas fa-dice-three',
    'fas fa-dice-four',
    'fas fa-dice-five',
    'fas fa-dice-six'
  ];
  
  diceElement.innerHTML = `<i class="${icons[value-1]}"></i>`;
}

// Érték sorrendjének ellenőrzése
function getValueRank(value) {
  const rankOrder = {
    '31': 1,  // legalacsonyabb
    '32': 2, '41': 3, '42': 4, '43': 5, '51': 6, '52': 7, '53': 8, '54': 9,
    '61': 10, '62': 11, '63': 12, '64': 13, '65': 14,
    '11': 15, '22': 16, '33': 17, '44': 18, '55': 19, '66': 20,
    '21': 21  // legmagasabb (Mia)
  };
  
  return rankOrder[value] || 0;
}

// Egy bejelentés jobb-e mint a másik
function isBetterClaim(newClaim, previousClaim) {
  if (!previousClaim) return true;
  return getValueRank(newClaim) > getValueRank(previousClaim);
}

// Érvényes-e a bejelentett érték
function isValidClaim(claim, previousClaim) {
  // Ha ez az első bejelentés, minden érvényes
  if (!previousClaim) return true;
  
  // Azonos vagy jobb bejelentés kell, mint az előző
  return getValueRank(claim) >= getValueRank(previousClaim);
}

// Játék log frissítése
function addToLog(message, type) {
  const logElement = document.getElementById('game-log');
  const entry = document.createElement('div');
  entry.className = `log-entry ${type}-log`;
  entry.textContent = message;
  logElement.appendChild(entry);
  logElement.scrollTop = logElement.scrollHeight;
}

// Életek frissítése
function updateLives() {
  const playerLivesElement = document.getElementById('playerLives');
  const opponentLivesElement = document.getElementById('opponentLives');
  
  playerLivesElement.innerHTML = '';
  opponentLivesElement.innerHTML = '';
  
  for (let i = 0; i < 6; i++) {
    const playerHeart = document.createElement('i');
    playerHeart.className = i < playerLives ? 'fas fa-heart life' : 'fas fa-heart life-lost';
    playerLivesElement.appendChild(playerHeart);
    
    const opponentHeart = document.createElement('i');
    opponentHeart.className = i < opponentLives ? 'fas fa-heart life' : 'fas fa-heart life-lost';
    opponentLivesElement.appendChild(opponentHeart);
  }
}

// Bejelentés frissítése
function updateClaim(player, claim) {
  const claimElement = document.getElementById(`${player}Claim`);
  claimElement.textContent = claim ? `Bejelentés: ${claim}` : 'Nincs bejelentés';
  
  lastClaim = claim;
}

// Aktív játékos kijelölése
function setActivePlayer(player) {
  const playerSection = document.getElementById('playerSection');
  const opponentSection = document.getElementById('opponentSection');
  
  playerSection.classList.toggle('active-player', player === 'player');
  opponentSection.classList.toggle('active-player', player === 'opponent');
  
  currentTurn = player;
}

// Kockák felfordítása/elrejtése
function revealDice(player, show) {
  const dice1Cover = document.getElementById(`${player}DiceCover1`);
  const dice2Cover = document.getElementById(`${player}DiceCover2`);
  
  dice1Cover.style.display = show ? 'none' : 'flex';
  dice2Cover.style.display = show ? 'none' : 'flex';
}

// Irányítópanelek megjelenítése/elrejtése
function toggleControls(phase) {
  const rollButton = document.getElementById('rollButton');
  const valueButtons = document.getElementById('valueButtons');
  const responseControls = document.getElementById('response-controls');
  
  switch (phase) {
    case 'roll':
      rollButton.style.display = 'inline-block';
      valueButtons.style.display = 'none';
      responseControls.style.display = 'none';
      break;
    case 'claim':
      rollButton.style.display = 'none';
      valueButtons.style.display = 'block';
      responseControls.style.display = 'none';
      break;
    case 'response':
      rollButton.style.display = 'none';
      valueButtons.style.display = 'none';
      responseControls.style.display = 'block';
      break;
    case 'none':
      rollButton.style.display = 'none';
      valueButtons.style.display = 'none';
      responseControls.style.display = 'none';
      break;
  }
}

// Játék vége ellenőrzése
function checkGameEnd() {
  if (playerLives <= 0) {
    gameActive = false;
    document.getElementById('announcement').innerHTML = '<span class="winner">Vereség! A Sötét Nagyúr legyőzött. Elfogytak az életeid.</span>';
    revealDice('player', true);
    revealDice('opponent', true);
    addToLog('A Sötét Nagyúr nyerte a játékot!', 'system');
    document.getElementById('resetContainer').style.display = 'block';
    toggleControls('none');
    return true;
  }
  
  if (opponentLives <= 0) {
    gameActive = false;
    document.getElementById('announcement').innerHTML = '<span class="winner">Győzelem! Legyőzted a Sötét Nagyurat. Elfogytak az ellenséged életei.</span>';
    revealDice('player', true);
    revealDice('opponent', true);
    addToLog('Gratulálunk! Legyőzted a Sötét Nagyurat!', 'system');
    document.getElementById('resetContainer').style.display = 'block';
    toggleControls('none');
    return true;
  }
  
  return false;
}

// Szabályleírás megjelenítése/elrejtése
function toggleRules() {
  const rules = document.getElementById('rules');
  rules.style.display = rules.style.display === 'none' ? 'block' : 'none';
}

//-------------------------
// JÁTÉKOS MŰVELETEK
//-------------------------

// Kockadobás (játékos)
function rollDice() {
  if (!gameActive || currentTurn !== 'player') return;
  
  // Kockaanimáció
  const diceElements = document.querySelectorAll('#playerDice .dice');
  diceElements.forEach(dice => {
    dice.classList.remove('dice-roll');
    void dice.offsetWidth; // Trükk az animáció újraindításához
    dice.classList.add('dice-roll');
  });
  
  // Kockadobás
  playerDice = rollDiceValues();
  diceValues = playerDice;
  
  // A kockaértékek megjelenítése
  const dice1 = document.querySelector('#playerDice .dice:first-child');
  const dice2 = document.querySelector('#playerDice .dice:last-child');
  showDiceValue(dice1, playerDice[0]);
  showDiceValue(dice2, playerDice[1]);
  
  // A dobott érték megjelenítése
  revealDice('player', true);
  
  // Bejelentési lehetőség adása a játékosnak
  document.getElementById('announcement').textContent = 'Jelentsd be az értéket! Dönthetsz az igazság vagy a blöff mellett.';
  toggleControls('claim');
  
  // Reset previous claim if this is a new round
  if (firstRoll) {
    lastClaim = null;
    updateClaim('player', null);
    updateClaim('opponent', null);
    firstRoll = false;
  }
  
  // Log frissítése
  addToLog('Dobtál a kockákkal.', 'player');
}

// Érték bejelentése (játékos)
function makePlayerClaim(claimValue) {
  if (!gameActive || currentTurn !== 'player') return;
  
  // Ellenőrizzük, hogy a bejelentés érvényes-e
  if (!isValidClaim(claimValue, lastClaim)) {
    document.getElementById('announcement').textContent = `Bejelentésednek azonosnak vagy magasabbnak kell lennie, mint ${lastClaim}!`;
    return;
  }
  
  // A játékos bejelenti az értéket
  updateClaim('player', claimValue);
  
  // A dobott és bejelentett érték összevetése a blöff nyomon követéséhez
  const actualValue = formatDiceValue(playerDice);
  const isBluffing = claimValue !== actualValue;
  playerBluffHistory.push({
    round: roundCount,
    claim: claimValue,
    actual: actualValue,
    isBluff: isBluffing
  });
  
  // Kockák elrejtése
  revealDice('player', false);
  
  // Az ellenfél jön
  setActivePlayer('opponent');
  
  // Az ellenfél reagálhat
  setTimeout(() => opponentDecide(), 1500);
  
  // Log frissítése
  addToLog(`Bejelentetted: ${claimValue}`, 'player');
  
  // Vezérlők frissítése
  toggleControls('none');
  document.getElementById('announcement').textContent = 'A Sötét Nagyúr gondolkodik...';
}

// Bejelentés elfogadása (játékos)
function acceptClaim() {
  if (!gameActive || currentTurn !== 'player') return;
  
  addToLog(`Elfogadtad a bejelentést: ${lastClaim}`, 'player');
  document.getElementById('announcement').textContent = 'Te jössz. Dobj a kockákkal!';
  
  // A játékos jön
  setActivePlayer('player');
  toggleControls('roll');
  
  // Kör növelése
  roundCount++;
}

// Bejelentés megkérdőjelezése (játékos)
function challengeClaim() {
  if (!gameActive || currentTurn !== 'player') return;
  
  // Felfedés
  revealDice('opponent', true);
  
  // Kiértékelés
  const opponentClaimValue = lastClaim;
  const opponentActualValue = formatDiceValue(opponentDice);
  
  addToLog(`Kihívtad a Sötét Nagyúr bejelentését: ${opponentClaimValue}`, 'player');
  addToLog(`A Sötét Nagyúr kockái: ${opponentActualValue}`, 'system');
  
  // A nyertes meghatározása
  if (opponentClaimValue !== opponentActualValue) {
    // A játékos nyert
    opponentLives--;
    updateLives();
    addToLog('A Sötét Nagyúr blöffölt! Veszít egy életet.', 'challenge');
    document.getElementById('announcement').textContent = 'Lebuktattad a Sötét Nagyurat! Sikeresen felismerted a blöfföt. A Sötét Nagyúr veszít egy életet.';
  } else {
    // Az ellenfél nyert
    playerLives--;
    updateLives();
    addToLog('A Sötét Nagyúr igazat mondott! Te veszítesz egy életet.', 'challenge');
    document.getElementById('announcement').textContent = 'A Sötét Nagyúr igazat mondott! Te veszítesz egy életet.';
  }
  
  // Ellenőrizük, hogy vége van-e a játéknak
  if (checkGameEnd()) return;
  
  // Új kör kezdése
  setTimeout(() => {
    // Kockák elrejtése
    revealDice('opponent', false);
    
    // Új kör kezdése a kihívás után
    firstRoll = true;
    setActivePlayer('player');
    toggleControls('roll');
    document.getElementById('announcement').textContent = 'Új kör kezdődik. Dobj a kockákkal!';
    
    // Kör növelése
    roundCount++;
  }, 3000);
}

//-------------------------
// ELLENFÉL AI LOGIKA
//-------------------------

// Az ellenfél döntése (elfogadás vagy kihívás)
function opponentDecide() {
  if (!gameActive || currentTurn !== 'opponent') return;
  
  // Elemezzük a játékos előző blöffjeit
  const playerBluffRate = calculatePlayerBluffRate();
  
  // A számítógép tulajdonképpen tud blöffölni, vagy dönthet a kihívás mellett
  const shouldChallenge = decideIfChallenge(playerBluffRate);
  
  if (shouldChallenge) {
    challengePlayerClaim();
  } else {
    opponentRoll();
  }
}

// Az ellenfél dobása
function opponentRoll() {
  if (!gameActive || currentTurn !== 'opponent') return;
  
  // Kockaanimáció
  const diceElements = document.querySelectorAll('#opponentDice .dice');
  diceElements.forEach(dice => {
    dice.classList.remove('dice-roll');
    void dice.offsetWidth;
    dice.classList.add('dice-roll');
  });
  
  // Kockadobás
  opponentDice = rollDiceValues();
  diceValues = opponentDice;
  
  // A kockaértékek megjelenítése (a játékos számára rejtve marad)
  const dice1 = document.querySelector('#opponentDice .dice:first-child');
  const dice2 = document.querySelector('#opponentDice .dice:last-child');
  showDiceValue(dice1, opponentDice[0]);
  showDiceValue(dice2, opponentDice[1]);
  
  // Az ellenfél elrejtve tartja az értékeket
  revealDice('opponent', false);
  
  addToLog('A Sötét Nagyúr dobott a kockákkal.', 'opponent');
  document.getElementById('announcement').textContent = 'A Sötét Nagyúr gondolkodik...';
  
  // Az ellenfél bejelent egy értéket
  setTimeout(() => opponentMakeClaim(), 1500);
}

// Az ellenfél értékbejelentése
function opponentMakeClaim() {
  if (!gameActive || currentTurn !== 'opponent') return;
  
  const actualValue = formatDiceValue(opponentDice);
  const claimValue = chooseOpponentClaim(actualValue);
  
  // Az ellenfél bejelenti az értéket
  updateClaim('opponent', claimValue);
  
  // A dobott és bejelentett érték összevetése
  const isBluffing = claimValue !== actualValue;
  opponentBluffHistory.push({
    round: roundCount,
    claim: claimValue,
    actual: actualValue,
    isBluff: isBluffing
  });
  
  // A játékos jön
  setActivePlayer('player');
  
  // A játékos reagálhat
  toggleControls('response');
  
  // Log frissítése
  addToLog(`A Sötét Nagyúr bejelentette: ${claimValue}`, 'opponent');
  document.getElementById('announcement').textContent = 'A Sötét Nagyúr bejelentett egy értéket. Elfogadod vagy kihívod?';
}

// Az ellenfél megkérdőjelezi a játékos bejelentését
function challengePlayerClaim() {
  if (!gameActive || currentTurn !== 'opponent') return;
  
  addToLog('A Sötét Nagyúr kihívja a bejelentésedet!', 'opponent');
  document.getElementById('announcement').textContent = 'A Sötét Nagyúr kétségbe vonja a bejelentésedet!';
  
  // Felfedés
  revealDice('player', true);
  
  // Kiértékelés
  const playerClaimValue = lastClaim;
  const playerActualValue = formatDiceValue(playerDice);
  
  setTimeout(() => {
    addToLog(`A te kockáid: ${playerActualValue}`, 'system');
    
    // A nyertes meghatározása
    if (playerClaimValue !== playerActualValue) {
      // Az ellenfél nyert
      playerLives--;
      updateLives();
      addToLog('Lebuktál! Veszítesz egy életet.', 'challenge');
      document.getElementById('announcement').textContent = 'A Sötét Nagyúr sikeresen leleplezte a blöffödet! Veszítesz egy életet.';
    } else {
      // A játékos nyert
      opponentLives--;
      updateLives();
      addToLog('Igazat mondtál! A Sötét Nagyúr veszít egy életet.', 'challenge');
      document.getElementById('announcement').textContent = 'Igazat mondtál! A Sötét Nagyúr tévesen kérdőjelezte meg az igazadat. A Sötét Nagyúr veszít egy életet.';
    }
    
    // Ellenőrizük, hogy vége van-e a játéknak
    if (checkGameEnd()) return;
    
    // Új kör kezdése
    setTimeout(() => {
      // Kockák elrejtése
      revealDice('player', false);
      
      // Új kör kezdése a kihívás után
      firstRoll = true;
      setActivePlayer('player');
      toggleControls('roll');
      document.getElementById('announcement').textContent = 'Új kör kezdődik. Dobj a kockákkal!';
      
      // Kör növelése
      roundCount++;
    }, 2000);
  }, 1500);
}

//-------------------------
// ELLENFÉL AI SEGÉDFÜGGVÉNYEK
//-------------------------

// A játékos blöffölési rátájának kiszámítása
function calculatePlayerBluffRate() {
  if (playerBluffHistory.length === 0) return 0.5; // Alap: 50% eséllyel blöfföl
  
  const recentHistory = playerBluffHistory.slice(-5); // Csak az utolsó 5 kört nézzük
  const bluffCount = recentHistory.filter(history => history.isBluff).length;
  
  return bluffCount / recentHistory.length;
}

// Az ellenfél eldönti, hogy elfogadja vagy kihívja a bejelentést
function decideIfChallenge(playerBluffRate) {
  // Alap kihívási valószínűség
  let challengeProb = 0.3;
  
  // Ha a játékos gyakran blöfföl, nagyobb eséllyel kihívjuk
  if (playerBluffRate > 0.6) {
    challengeProb += 0.3;
  }
  
  // Ha a játékos ritkán blöfföl, kisebb eséllyel kihívjuk
  if (playerBluffRate < 0.3) {
    challengeProb -= 0.15;
  }
  
  // Ha a játékos által bejelentett érték nagyon magas, nagyobb eséllyel kihívjuk
  const playerClaimRank = getValueRank(lastClaim);
  if (playerClaimRank > 15) { // Párok vagy Mia
    challengeProb += 0.2;
  }
  
  // Ha az ellenfélnek kevés élete van, kockázatosabb stratégiát követ
  if (opponentLives <= 2) {
    challengeProb += 0.15;
  }
  
  // Véletlenszerű döntés a kiszámított valószínűség alapján
  return Math.random() < challengeProb;
}

// Az ellenfél bejelentésének kiválasztása
function chooseOpponentClaim(actualValue) {
  const actualRank = getValueRank(actualValue);
  const lastClaimRank = lastClaim ? getValueRank(lastClaim) : 0;
  
  // Ha az aktuális dobás jobb, mint az utolsó bejelentés, igazat mond
  if (actualRank > lastClaimRank) {
    return actualValue;
  }
  
  // Ha jó dobása van, általában igazat mond
  if (actualRank >= 15) { // Pár vagy Mia
    return actualValue;
  }
  
  // Blöffölési valószínűség kiszámítása
  let bluffProb = 0.7; // Alapvalószínűség
  
  // Ha kevés élete van, nagyobb valószínűséggel blöfföl
  if (opponentLives <= 2) {
    bluffProb += 0.2;
  }
  
  // Ha a játékos ritkán kérdőjelezi meg a bejelentést, nagyobb valószínűséggel blöfföl
  const playerChallengeRate = calculatePlayerChallengeRate();
  if (playerChallengeRate < 0.3) {
    bluffProb += 0.15;
  }
  
  // Döntés a blöffölésről
  if (Math.random() < bluffProb) {
    // Blöffölés: válasszunk egy magasabb értéket
    return chooseBluffValue(lastClaimRank);
  } else {
    // Igazat mond, de ha az aktuális dobás nem elég jó, akkor az előzőt éppen meghaladó értéket jelentünk be
    if (actualRank <= lastClaimRank) {
      return chooseNextBestValue(lastClaimRank);
    }
    return actualValue;
  }
}

// Blöff érték kiválasztása
function chooseBluffValue(lastRank) {
  // Válasszunk egy magasabb értéket, de ne a legmagasabbat
  const maxRank = 21; // Mia a legmagasabb
  const minRank = Math.max(lastRank + 1, 2);
  const maxChosen = Math.min(maxRank, lastRank + 5); // Ne legyen túl nagy a blöff
  
  const chosenRank = Math.floor(Math.random() * (maxChosen - minRank + 1)) + minRank;
  
  // Keressük meg a rangnak megfelelő értéket
  for (let value in getValueRankMap()) {
    if (getValueRank(value) === chosenRank) {
      return value;
    }
  }
  
  // Biztonsági visszatérési érték
  return chooseNextBestValue(lastRank);
}

// A játékos kihívási rátájának kiszámítása
function calculatePlayerChallengeRate() {
  // A kihívások számát nem tudjuk közvetlenül mérni, helyette a játékos viselkedését elemezzük
  // Ez egy egyszerűsített megközelítés
  if (roundCount < 3) return 0.5; // Alapértelmezett érték kevés kör esetén
  
  // Eddig hányszor kérdőjelezte meg a játékos a bejelentést
  const challengeActions = playerBluffHistory.filter(h => h.isChallenged).length;
  return challengeActions / roundCount;
}

// Rangértékek térképe
function getValueRankMap() {
  return {
    '31': 1,  // legalacsonyabb
    '32': 2, '41': 3, '42': 4, '43': 5, '51': 6, '52': 7, '53': 8, '54': 9,
    '61': 10, '62': 11, '63': 12, '64': 13, '65': 14,
    '11': 15, '22': 16, '33': 17, '44': 18, '55': 19, '66': 20,
    '21': 21  // legmagasabb (Mia)
  };
}

// A legközelebbi jobb érték kiválasztása
function chooseNextBestValue(lastRank) {
  const rankMap = getValueRankMap();
  const nextRank = lastRank + 1;
  
  for (let value in rankMap) {
    if (rankMap[value] === nextRank) {
      return value;
    }
  }
  
  // Ha nincs magasabb érték, válasszuk a legmagasabbat
  return '21'; // Mia
}

//-------------------------
// JÁTÉK INICIALIZÁLÁS
//-------------------------

// Játék indítása
function startGame() {
  // Alapállapotba állítás
  playerLives = 6;
  opponentLives = 6;
  playerDice = [1, 1];
  opponentDice = [1, 1];
  gameActive = true;
  currentTurn = 'player';
  lastClaim = null;
  playerBluffHistory = [];
  opponentBluffHistory = [];
  roundCount = 0;
  firstRoll = true;
  
  // UI frissítése
  updateLives();
  updateClaim('player', null);
  updateClaim('opponent', null);
  setActivePlayer('player');
  revealDice('player', false);
  revealDice('opponent', false);
  
  // Kockák alaphelyzetbe állítása
  const playerDice1 = document.querySelector('#playerDice .dice:first-child');
  const playerDice2 = document.querySelector('#playerDice .dice:last-child');
  const opponentDice1 = document.querySelector('#opponentDice .dice:first-child');
  const opponentDice2 = document.querySelector('#opponentDice .dice:last-child');
  
  showDiceValue(playerDice1, 1);
  showDiceValue(playerDice2, 1);
  showDiceValue(opponentDice1, 1);
  showDiceValue(opponentDice2, 1);
  
  // Vezérlők alaphelyzetbe állítása
  toggleControls('roll');
  document.getElementById('resetContainer').style.display = 'none';
  
  // Log törlése
  document.getElementById('game-log').innerHTML = '';
  addToLog('Új játék kezdődött. Jó szerencsét!', 'system');
  
  // Üzenet
  document.getElementById('announcement').textContent = 'Dobáshoz kattints a "Dobás" gombra. Kezdj egy új kört!';
}

// Játék inicializálása
startGame();

// Szabályleírás elrejtése kezdéskor
document.getElementById('rules').style.display = 'none';
</script>

</body>
</html>
