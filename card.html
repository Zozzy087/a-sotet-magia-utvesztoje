<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Kártyapárbaj</title>
  <style>
    body {
      font-family: sans-serif;
      background: #222;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    .hand {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    .card {
      background: #444;
      border: 2px solid #888;
      padding: 10px;
      width: 140px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.05);
      border-color: #fff;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    .winner {
      color: lightgreen;
      font-weight: bold;
    }
    #battlefield {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 50px;
    }
  </style>
</head>
<body>

<h1>Kártyapárbaj</h1>

<p id="turnInfo">Várakozás a játék indítására...</p>

<div id="attributeButtons">
  <button onclick="chooseAttribute('power')">Erő</button>
  <button onclick="chooseAttribute('agility')">Ügyesség</button>
  <button onclick="chooseAttribute('wisdom')">Bölcsesség</button>
</div>

<h2 id="chosenAttr"></h2>

<div class="hand" id="player1Hand"></div>

<div id="battlefield"></div>

<h2 id="result"></h2>
<h3 id="score"></h3>

<script>
const allCards = [];
for (let i = 1; i <= 50; i++) {
  allCards.push({
    id: i,
    name: "Kártya " + i,
    power: Math.floor(Math.random() * 10) + 1,
    agility: Math.floor(Math.random() * 10) + 1,
    wisdom: Math.floor(Math.random() * 10) + 1
  });
}

let player1Deck = [];
let player2Deck = [];
let player1Wins = 0;
let player2Wins = 0;
let lastWinner = "player1";
let selectedAttribute = null;
let roundInProgress = false;

function startGame() {
  const shuffled = [...allCards].sort(() => Math.random() - 0.5);
  player1Deck = shuffled.slice(0, 8);
  player2Deck = shuffled.slice(8, 16);
  player1Wins = 0;
  player2Wins = 0;
  lastWinner = "player1";
  selectedAttribute = null;
  roundInProgress = false;
  updateUI();
}

function updateUI() {
  document.getElementById("result").textContent = "";
  document.getElementById("chosenAttr").textContent = selectedAttribute ? `Kiválasztott tulajdonság: ${attributeHu(selectedAttribute)}` : "";
  document.getElementById("score").textContent = `Állás: Játékos 1 - ${player1Wins} | Játékos 2 - ${player2Wins}`;
  document.getElementById("turnInfo").textContent = lastWinner === "player1" ? "Játékos 1 választhat tulajdonságot." : "Bot választ tulajdonságot...";
  document.getElementById("player1Hand").innerHTML = "";
  document.getElementById("battlefield").innerHTML = "";

  renderPlayer1Hand();
  if (lastWinner === "player2" && !selectedAttribute && !roundInProgress) {
  setTimeout(() => {
    const attrs = ["power", "agility", "wisdom"];
    selectedAttribute = attrs[Math.floor(Math.random() * 3)];
    document.getElementById("chosenAttr").textContent = `Kiválasztott tulajdonság: ${attributeHu(selectedAttribute)}`;

    // Bot kiválasztja a legjobb lapját a kiválasztott tulajdonság alapján
    const bestBotIndex = getBestCardIndex(player2Deck, selectedAttribute);
    const dummyIndex = Math.floor(Math.random() * player1Deck.length); // dummy, nem számít
    playRound(dummyIndex, bestBotIndex, true); // true jelzi, hogy a bot kezd

  }, 1000);
}

  const buttons = document.querySelectorAll("#attributeButtons button");
  buttons.forEach(btn => {
    btn.disabled = lastWinner !== "player1" || selectedAttribute !== null;
  });
}

function attributeHu(attr) {
  return attr === "power" ? "Erő" : attr === "agility" ? "Ügyesség" : "Bölcsesség";
}

function chooseAttribute(attr) {
  if (lastWinner !== "player1" || selectedAttribute !== null) return;
  selectedAttribute = attr;
  document.getElementById("chosenAttr").textContent = `Kiválasztott tulajdonság: ${attributeHu(selectedAttribute)}`;
  updateUI();
}

function renderPlayer1Hand() {
  player1Deck.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <strong>${card.name}</strong><br>
      Erő: ${card.power}<br>
      Ügyesség: ${card.agility}<br>
      Bölcsesség: ${card.wisdom}
    `;
    if (!selectedAttribute || roundInProgress) {
      div.classList.add("disabled");
    } else {
      div.onclick = () => playRound(index);
    }
    document.getElementById("player1Hand").appendChild(div);
  });
}

function playRound(player1Index, botIndex = null, botInitiated = false) {
  if (!selectedAttribute || roundInProgress) return;
  roundInProgress = true;

  const player1Card = botInitiated
  ? player1Deck.splice(Math.floor(Math.random() * player1Deck.length), 1)[0] // ha bot hívja, dummy lap
  : player1Deck.splice(player1Index, 1)[0];

  // Bot döntés: választhatna okosan is, most véletlenszerű
  const finalBotIndex = botIndex !== null 
  ? botIndex 
  : getBestCardIndex(player2Deck, selectedAttribute, player1Card[selectedAttribute]);

const player2Card = player2Deck.splice(finalBotIndex, 1)[0];

  const val1 = player1Card[selectedAttribute];
  const val2 = player2Card[selectedAttribute];

  const battleDiv = document.getElementById("battlefield");
  battleDiv.innerHTML = `
    <div class="card">
      <h3>Játékos 1</h3>
      <p>${player1Card.name}</p>
      <p>Erő: ${player1Card.power}</p>
      <p>Ügyesség: ${player1Card.agility}</p>
      <p>Bölcsesség: ${player1Card.wisdom}</p>
    </div>
    <div class="card">
      <h3>Játékos 2</h3>
      <p>${player2Card.name}</p>
      <p>Erő: ${player2Card.power}</p>
      <p>Ügyesség: ${player2Card.agility}</p>
      <p>Bölcsesség: ${player2Card.wisdom}</p>
    </div>
  `;

  let resultText = "";
  if (val1 > val2) {
    player1Wins++;
    resultText = "Játékos 1 nyerte a kört!";
    lastWinner = "player1";
  } else if (val2 > val1) {
    player2Wins++;
    resultText = "Játékos 2 nyerte a kört!";
    lastWinner = "player2";
  } else {
    resultText = "Döntetlen!";
    // Döntetlennél megtartjuk az előző nyertest
  }

  document.getElementById("result").textContent = resultText;
  selectedAttribute = null;

  if (player1Wins >= 5 || player2Wins >= 5) {
    document.getElementById("result").innerHTML += `<br><span class="winner">${player1Wins >= 5 ? "Játékos 1" : "Játékos 2"} győzött a játékban!</span>`;
    disableAll();
    return;
  }

  setTimeout(() => {
    roundInProgress = false;
    updateUI();
  }, 1500);
}

function disableAll() {
  const buttons = document.querySelectorAll("button");
  buttons.forEach(btn => btn.disabled = true);
  document.getElementById("player1Hand").innerHTML = "";
}

  function getBestCardIndex(deck, attribute, playerCardValue = null) {
  if (playerCardValue !== null) {
    // Megnézzük, van-e olyan lap, ami legyőzheti vagy legalább döntetlen
    let candidates = deck
      .map((card, index) => ({ value: card[attribute], index }))
      .filter(entry => entry.value >= playerCardValue);

    if (candidates.length > 0) {
      // Ha van olyan, ami legalább döntetlen, akkor a leggyengébbet választjuk közülük
      candidates.sort((a, b) => a.value - b.value);
      return candidates[0].index;
    } else {
      // Ha nincs esélye, akkor dobja el a leggyengébb lapját
      let weakest = deck.map((card, index) => ({ value: card[attribute], index }));
      weakest.sort((a, b) => a.value - b.value);
      return weakest[0].index;
    }
  } else {
    // Bot választott tulajdonságot – játsszon a legerősebbjével
    let bestValue = -1;
    let bestIndex = 0;
    deck.forEach((card, index) => {
      if (card[attribute] > bestValue) {
        bestValue = card[attribute];
        bestIndex = index;
      }
    });
    return bestIndex;
  }
}

startGame();
</script>

</body>
</html>
