<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Kártyapárbaj</title>
  <style>
    body {
      font-family: sans-serif;
      background: #222;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    .hand {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin: 10px 0;
    }
    .card {
      background: #444;
      border: 2px solid #888;
      border-radius: 5px;
      padding: 10px;
      margin: 5px;
      width: 120px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.05);
      background: #555;
    }
    .selected {
      border-color: gold;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
    }
    #cards, #result {
      margin-top: 20px;
    }
    .winner {
      font-weight: bold;
      color: lightgreen;
    }
    .hidden {
      visibility: hidden;
    }
  </style>
</head>
<body>

<h1>Kártyapárbaj</h1>

<p id="turnInfo">Várakozás a játék indítására...</p>
<div id="attributeButtons" class="hidden">
  <button onclick="chooseAttribute('power')">Erő</button>
  <button onclick="chooseAttribute('agility')">Ügyesség</button>
  <button onclick="chooseAttribute('wisdom')">Bölcsesség</button>
</div>

<h3>Játékos 1 lapjai</h3>
<div id="player1Hand" class="hand"></div>

<h3 id="roundLabel">Kijátszott lapok</h3>
<div id="cards" class="hand"></div>

<h2 id="result"></h2>
<h3 id="score"></h3>

<script>
const allCards = [];
for (let i = 1; i <= 50; i++) {
  allCards.push({
    id: i,
    name: "Kártya " + i,
    power: Math.floor(Math.random() * 10) + 1,
    agility: Math.floor(Math.random() * 10) + 1,
    wisdom: Math.floor(Math.random() * 10) + 1
  });
}

let player1Deck = [];
let player2Deck = [];
let player1Wins = 0;
let player2Wins = 0;
let round = 0;

let lastWinner = null;
let consecutiveWins = { player1: 0, player2: 0 };
let currentTurn = "player1";
let currentAttribute = null;
let selectedCard = null;

function drawHands() {
  const shuffled = [...allCards].sort(() => Math.random() - 0.5);
  player1Deck = shuffled.slice(0, 8);
  player2Deck = shuffled.slice(8, 16);
  player1Wins = 0;
  player2Wins = 0;
  round = 0;
  lastWinner = null;
  consecutiveWins = { player1: 0, player2: 0 };
  currentTurn = "player1";
  currentAttribute = null;
  selectedCard = null;
  updateScore();
  updateTurnInfo();
  displayHand();
  document.getElementById("result").textContent = "";
  document.getElementById("cards").innerHTML = "";
  document.getElementById("attributeButtons").classList.add("hidden");
}

function updateScore() {
  document.getElementById("score").textContent = `Állás: Játékos 1 - ${player1Wins} | Játékos 2 - ${player2Wins}`;
}

function updateTurnInfo() {
  if (player1Wins >= 5 || player2Wins >= 5) {
    document.getElementById("turnInfo").textContent = "A játék véget ért!";
    return;
  }
  const who = currentTurn === "player1" ? "Te választhatsz tulajdonságot!" : "A bot választ...";
  document.getElementById("turnInfo").textContent = who;
  if (currentTurn === "player1") {
    document.getElementById("attributeButtons").classList.remove("hidden");
  } else {
    document.getElementById("attributeButtons").classList.add("hidden");
    setTimeout(() => {
      const attrs = ["power", "agility", "wisdom"];
      const attr = attrs[Math.floor(Math.random() * 3)];
      chooseAttribute(attr);
    }, 800);
  }
}

function chooseAttribute(attr) {
  currentAttribute = attr;
  document.getElementById("turnInfo").textContent = `Tulajdonság: ${attr.toUpperCase()} – válassz egy lapot a kezedből!`;
  document.getElementById("attributeButtons").classList.add("hidden");
}

function displayHand() {
  const container = document.getElementById("player1Hand");
  container.innerHTML = "";
  player1Deck.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <strong>${card.name}</strong><br>
      Erő: ${card.power}<br>
      Ügyesség: ${card.agility}<br>
      Bölcsesség: ${card.wisdom}
    `;
    div.onclick = () => {
      if (!currentAttribute) return;
      selectedCard = card;
      player1Deck.splice(index, 1);
      container.innerHTML = "";
      playBotTurn(card);
    };
    container.appendChild(div);
  });
}

function playBotTurn(playerCard) {
  // Bot kiválasztja a legjobb lapját az adott attribútum alapján
  const sorted = [...player2Deck].sort((a, b) => b[currentAttribute] - a[currentAttribute]);
  const botCard = sorted[0];
  const botIndex = player2Deck.indexOf(botCard);
  player2Deck.splice(botIndex, 1);

  // Eredmény kiszámítása
  const val1 = playerCard[currentAttribute];
  const val2 = botCard[currentAttribute];
  let resultText = "";

  if (val1 > val2) {
    player1Wins++;
    resultText = "Ezt a kört Játékos 1 nyerte!";
    lastWinner = "player1";
    consecutiveWins.player1++;
    consecutiveWins.player2 = 0;
  } else if (val2 > val1) {
    player2Wins++;
    resultText = "Ezt a kört Játékos 2 (bot) nyerte!";
    lastWinner = "player2";
    consecutiveWins.player2++;
    consecutiveWins.player1 = 0;
  } else {
    resultText = "Döntetlen!";
    // nem változik a döntő
  }

  // Kijátszott lapok megjelenítése
  document.getElementById("cards").innerHTML = `
    <div class="card selected">
      <h4>Játékos 1</h4>
      <strong>${playerCard.name}</strong><br>
      Erő: ${playerCard.power}<br>
      Ügyesség: ${playerCard.agility}<br>
      Bölcsesség: ${playerCard.wisdom}
    </div>
    <div class="card selected">
      <h4>Játékos 2</h4>
      <strong>${botCard.name}</strong><br>
      Erő: ${botCard.power}<br>
      Ügyesség: ${botCard.agility}<br>
      Bölcsesség: ${botCard.wisdom}
    </div>
  `;
  document.getElementById("result").textContent = resultText;
  updateScore();
  round++;

  // Győzelem ellenőrzés
  if (player1Wins >= 5 || player2Wins >= 5) {
    document.getElementById("result").innerHTML += ` <span class='winner'>${player1Wins > player2Wins ? "Játékos 1 győzött!" : "Játékos 2 (bot) győzött!"}</span>`;
    return;
  }

  // Ki választ legközelebb?
  if (lastWinner === "player1" && consecutiveWins.player1 < 2) {
    currentTurn = "player1";
  } else if (lastWinner === "player2" && consecutiveWins.player2 < 2) {
    currentTurn = "player2";
  } else {
    currentTurn = lastWinner === "player1" ? "player2" : "player1";
    consecutiveWins = { player1: 0, player2: 0 }; // reset
  }

  currentAttribute = null;
  selectedCard = null;

  setTimeout(() => {
    updateTurnInfo();
    displayHand();
    document.getElementById("cards").innerHTML = "";
    document.getElementById("result").textContent = "";
  }, 1500);
}

drawHands();
</script>

</body>
</html>
