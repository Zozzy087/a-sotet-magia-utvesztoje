<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>K√°rtyap√°rbaj</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Cinzel', serif;
      background-image: url('images/background.jpg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #ffffff;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      background-color: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 0 15px rgba(127, 0, 255, 0.7);
      text-align: center;
    }
    #turnInfo, #chosenAttr, #result, #score {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 5px;
      margin: 10px auto;
      box-shadow: 0 0 10px rgba(127, 0, 255, 0.4);
      text-align: center;
    }
    #attributeButtons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px auto;
    }
    button {
      background-color: #7f00ff;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 10px #7f00ff;
      transition: transform 0.2s, box-shadow 0.3s;
    }
    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px #a94bff;
    }
    .hand {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    .card {
      background-color: rgba(0, 0, 0, 0.8);
      border: 2px solid #7f00ff;
      padding: 12px;
      width: 140px;
      color: #fff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.3s;
      box-shadow: 0 0 10px rgba(127, 0, 255, 0.3);
      border-radius: 8px;
      text-align: left;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(127, 0, 255, 0.6);
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    .winner {
      color: #7fff7f;
      font-weight: bold;
      text-shadow: 1px 1px 4px black;
    }
    #battlefield {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    #resetContainer {
      margin-top: 20px;
      display: none;
    }
    #chosenAttr:empty, #result:empty {
      display: none;
    }
  </style>
</head>
<body>

<h1>K√°rtyap√°rbaj</h1>

<p id="turnInfo">V√°rakoz√°s a j√°t√©k ind√≠t√°s√°ra...</p>

<div id="attributeButtons">
  <button onclick="chooseAttribute('power')">Er≈ë</button>
  <button onclick="chooseAttribute('agility')">√úgyess√©g</button>
  <button onclick="chooseAttribute('wisdom')">B√∂lcsess√©g</button>
</div>

<h2 id="chosenAttr"></h2>

<div class="hand" id="player1Hand"></div>

<div id="battlefield"></div>

<h2 id="result"></h2>
<h3 id="score"></h3>

<div id="resetContainer">
  <button onclick="startGame()">√öj j√°t√©k</button>
</div>

<script>
const allCards = [];
for (let i = 0; i < 100; i++) {
  allCards.push({
    power: Math.floor(Math.random() * 10) + 1,
    agility: Math.floor(Math.random() * 10) + 1,
    wisdom: Math.floor(Math.random() * 10) + 1
  });
}

let deckPool = [], player1Deck = [], player2Deck = [];
let player1Wins = 0, player2Wins = 0;
let lastWinner = "player1";
let selectedAttribute = null;
let roundInProgress = false;

function drawCard() {
  if (deckPool.length === 0) return null;
  return deckPool.splice(Math.floor(Math.random() * deckPool.length), 1)[0];
}

function refillHands() {
  while (player1Deck.length < 3) {
    const card = drawCard();
    if (card) player1Deck.push(card); else break;
  }
  while (player2Deck.length < 3) {
    const card = drawCard();
    if (card) player2Deck.push(card); else break;
  }
}

function startGame() {
  deckPool = [...allCards];
  player1Deck = [];
  player2Deck = [];
  player1Wins = 0;
  player2Wins = 0;
  lastWinner = "player1";
  selectedAttribute = null;
  roundInProgress = false;

  // Gombok √∫jra enged√©lyez√©se
  const allButtons = document.querySelectorAll("button");
  allButtons.forEach(btn => btn.disabled = false);

  // üîß Ezt jav√≠tottuk itt:
  document.getElementById("result").innerHTML = "";
  document.getElementById("chosenAttr").textContent = "";
  document.getElementById("battlefield").innerHTML = "";
  document.getElementById("player1Hand").innerHTML = "";

  document.getElementById("resetContainer").style.display = "none";

  refillHands();
  updateUI();
}

function attributeHu(attr) {
  return attr === "power" ? "Er≈ë" : attr === "agility" ? "√úgyess√©g" : "B√∂lcsess√©g";
}

function updateUI() {
  const chosen = document.getElementById("chosenAttr");
  if (selectedAttribute) {
    chosen.textContent = `Kiv√°lasztott tulajdons√°g: ${attributeHu(selectedAttribute)}`;
  } else {
    chosen.textContent = "";
  }

  document.getElementById("score").textContent = `√Åll√°s: J√°t√©kos 1 - ${player1Wins} | J√°t√©kos 2 - ${player2Wins}`;
  document.getElementById("turnInfo").textContent = lastWinner === "player1"
    ? "J√°t√©kos 1 v√°laszthat tulajdons√°got." : "Bot v√°laszt...";
  document.getElementById("player1Hand").innerHTML = "";
  document.getElementById("battlefield").innerHTML = "";

  renderPlayer1Hand();

  // Bot v√°laszt automatikusan
  if (lastWinner === "player2" && !selectedAttribute && !roundInProgress) {
    setTimeout(() => {
      const attrs = ["power", "agility", "wisdom"];
      selectedAttribute = attrs[Math.floor(Math.random() * 3)];
      updateUI();
    }, 1000);
  }

  // Gombok enged√©lyez√©se
  const buttons = document.querySelectorAll("#attributeButtons button");
  buttons.forEach(btn => {
    btn.disabled = lastWinner !== "player1" || selectedAttribute !== null;
  });
}

function chooseAttribute(attr) {
  if (lastWinner !== "player1" || selectedAttribute !== null) return;
  selectedAttribute = attr;
  updateUI();
}

function renderPlayer1Hand() {
  player1Deck.forEach((card, index) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `Er≈ë: ${card.power}<br>√úgyess√©g: ${card.agility}<br>B√∂lcsess√©g: ${card.wisdom}`;
    if (!selectedAttribute || roundInProgress) {
      div.classList.add("disabled");
    } else {
      div.onclick = () => playRound(index);
    }
    document.getElementById("player1Hand").appendChild(div);
  });
}

function playRound(player1Index) {
  if (!selectedAttribute || roundInProgress) return;
  roundInProgress = true;

  const player1Card = player1Deck.splice(player1Index, 1)[0];
  const botIndex = getBestCardIndex(player2Deck, selectedAttribute, player1Card[selectedAttribute]);
  const player2Card = player2Deck.splice(botIndex, 1)[0];

  const val1 = player1Card[selectedAttribute];
  const val2 = player2Card[selectedAttribute];

  document.getElementById("battlefield").innerHTML = `
    <div class="card">
      <h3>J√°t√©kos 1</h3>
      <p>Er≈ë: ${player1Card.power}</p>
      <p>√úgyess√©g: ${player1Card.agility}</p>
      <p>B√∂lcsess√©g: ${player1Card.wisdom}</p>
    </div>
    <div class="card">
      <h3>J√°t√©kos 2</h3>
      <p>Er≈ë: ${player2Card.power}</p>
      <p>√úgyess√©g: ${player2Card.agility}</p>
      <p>B√∂lcsess√©g: ${player2Card.wisdom}</p>
    </div>
  `;

  let resultText = "";
  if (val1 > val2) {
    player1Wins++;
    resultText = "J√°t√©kos 1 nyerte a k√∂rt!";
    lastWinner = "player1";
  } else if (val2 > val1) {
    player2Wins++;
    resultText = "J√°t√©kos 2 nyerte a k√∂rt!";
    lastWinner = "player2";
  } else {
    resultText = "D√∂ntetlen!";
  }

  document.getElementById("result").textContent = resultText;
  selectedAttribute = null;

  if (player1Wins >= 5 || player2Wins >= 5) {
    document.getElementById("result").innerHTML += `<br><span class="winner">${player1Wins >= 5 ? "J√°t√©kos 1" : "J√°t√©kos 2"} gy≈ëz√∂tt a j√°t√©kban!</span>`;
    disableAll();
    document.getElementById("resetContainer").style.display = "block";
    return;
  }

  setTimeout(() => {
    refillHands();
    roundInProgress = false;
    updateUI();
  }, 1500);
}

function disableAll() {
  const buttons = document.querySelectorAll("button");
  buttons.forEach(btn => btn.disabled = true);
  document.getElementById("player1Hand").innerHTML = "";
}

function getBestCardIndex(deck, attribute, playerCardValue) {
  const candidates = deck
    .map((card, index) => ({ value: card[attribute], index }))
    .filter(entry => entry.value >= playerCardValue);

  if (candidates.length > 0) {
    candidates.sort((a, b) => a.value - b.value);
    return candidates[0].index;
  } else {
    return deck
      .map((card, index) => ({ value: card[attribute], index }))
      .sort((a, b) => a.value - b.value)[0].index;
  }
}

startGame();
</script>
</body>
</html>
